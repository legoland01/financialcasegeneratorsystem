# 金融案件测试数据生成系统 - 全套测试方案

## 测试信息

- **测试日期**: 2026-01-21
- **测试版本**: v1.0.3-alpha
- **测试人员**: opencode
- **测试环境**: macOS
- **测试目标**: 全面测试系统功能，验证所有问题是否修复

---

## 测试范围

### A. 证据包生成测试
### B. PDF生成测试
### C. 标准答案集测试
### D. 全自动执行测试
### E. 交互式确认测试
### F. 代码质量测试

---

## 一、证据包生成测试

### 测试1.1：证据组数量验证

**测试目的**: 验证所有证据组是否都已生成

**测试步骤**:
```bash
cd financial_case_generator_system
python3 -c "
import json
from pathlib import Path

# 读取plaintiff_package.json
data = json.loads(Path('outputs/stage1/plaintiff_package.json').read_text(encoding='utf-8'))
evidence_package = data.get('证据包', {})

print('=== 证据组数量统计 ===')
print(f'证据组总数: {len(evidence_package)}')

# 列出所有证据组
for group_key in sorted(evidence_package.keys()):
    group_data = evidence_package[group_key]
    print(f'{group_key}:')
    if isinstance(group_data, dict):
        if 'content' in group_data:
            content_len = len(group_data['content'])
            print(f'  包含证据内容: {content_len} 字符')
        if 'output_path' in group_data:
            file_path = group_data['output_path']
            if Path(file_path).exists():
                file_size = Path(file_path).stat().st_size
                print(f'  文件大小: {file_size} 字节')
            else:
                print(f'  文件不存在')
print()
print('=== 0.5证据归属规划表 ===')
# 读取证据归属规划表
planning = json.loads(Path('outputs/stage0/0.5_evidence_planning.json').read_text(encoding='utf-8'))
plaintiff_evidence = [e for e in planning['证据归属规划表'] if e['应归属方'] == '原告']

# 统计证据组数量
evidence_groups = {}
for evidence in plaintiff_evidence:
    group_id = evidence.get('证据组', 1)
    if group_id not in evidence_groups:
        evidence_groups[group_id] = []
    evidence_groups[group_id].append(evidence)

print(f'0.5中原告证据组数量: {len(evidence_groups)}')
for group_id in sorted(evidence_groups.keys()):
    count = len(evidence_groups[group_id])
    print(f'   证据组{group_id}: {count} 个证据')
"
"
```

**预期结果**:
- ✅ 证据组总数应 >= 8（根据0.5证据归属规划表）
- ✅ 每个证据组都有独立的txt文件
- ✅ 文件命名应符合规范：`原告证据包_证据组X.txt`

**测试结果**: ⏸️ 待执行

**状态**: ⚠️ 需要执行

---

### 测试1.2：证据文件内容验证

**测试目的**: 验证每个证据文件的内容是否完整，是否包含markdown符号

**测试步骤**:
```bash
cd financial_case_generator_system
ls -lh outputs/stage1/*.txt
echo ""
echo "=== 检查markdown符号 ==="
grep -n "```json\|```\|\*\*\|#\|>" outputs/stage1/*.txt | head -20
echo ""
echo "=== 检查文件大小分布 ==="
ls -lS outputs/stage1/*.txt | awk '{print $5, $9}'
"
```

**预期结果**:
- ✅ 不应包含markdown符号（```、**、#、>等）
- ✅ 文件大小应该合理（通常10-100KB）
- ✅ 应该有8-10个证据文件

**测试结果**: ⏸️ 待执行

**状态**: ⚠️ 需要执行

---

### 测试1.3：证据组完整性验证

**测试目的**: 验证每个证据组是否包含对应数量的证据

**测试步骤**:
```bash
cd financial_case_generator_system
python3 -c "
import json
from pathlib import Path

# 读取0.5证据归属规划表
planning = json.loads(Path('outputs/stage0/0.5_evidence_planning.json').read_text(encoding='utf-8'))

# 统计每个证据组的证据数量
evidence_groups = {}
for evidence in planning['证据归属规划表']:
    group_id = evidence.get('证据组', 1)
    if group_id not in evidence_groups:
        evidence_groups[group_id] = []
    evidence_groups[group_id].append(evidence)

print('=== 证据组证据数量统计 ===')
for group_id in sorted(evidence_groups.keys()):
    count = len(evidence_groups[group_id])
    print(f'  证据组{group_id}: {count} 个证据')

print()
print('=== 检查原告证据包中的证据组 ===')
for file_path in Path('outputs/stage1').glob('原告证据包_证据组*.txt'):
    content = file_path.read_text(encoding='utf-8')
    lines = content.split('\n')
    print(f'{file_path.name}: {len(lines)} 行')
    
    # 统计证据数量（简单方法：查找"证据"或"附件"等关键词）
    evidence_count = content.count('证据')
    print(f'  关键词"证据"出现次数: {evidence_count}')
"
"
```

**预期结果**:
- ✅ 每个证据组应包含对应数量的证据
- ✅ 证据组1应该有3-4个证据
- ✅ 证据组2应该有2-3个证据
- ✅ 等等...

**测试结果**: ⏸️ 待执行

**状态**: ⚠️ 需要执行

---

## 二、PDF生成测试

### 测试2.1：PDF文件验证

**测试目的**: 验证PDF文件是否成功生成，能否正常打开

**测试步骤**:
```bash
cd financial_case_generator_system

echo "=== PDF文件统计 ==="
ls -lh outputs/*.pdf | awk '{print $9, $5}'

echo ""
echo "=== 尝试读取PDF信息 ==="
python3 -c "
import sys
from pathlib import Path

pdf_files = list(Path('outputs').glob('*.pdf'))
for pdf_path in sorted(pdf_files):
    size = pdf_path.stat().st_size
    print(f'{pdf_path.name}: {size:,} 字节 ({size/1024:.2f} KB)')
"
```

**预期结果**:
- ✅ 应该有多个PDF文件（至少2个：完整测试卷宗、标准答案集）
- ✅ PDF文件大小应该合理（100-500KB）
- ✅ PDF文件应该能被正常打开

**测试结果**: ⏸️ 待执行

**状态**: ⚠️ 需要执行

---

### 测试2.2：PDF内容验证

**测试目的**: 验证PDF内容是否包含markdown符号，格式是否正确

**测试步骤**:
```bash
cd financial_case_generator_system

echo "=== 检查最新完整测试卷宗PDF ==="
# 由于没有PyPDF2，暂时跳过PDF内容验证
echo "注意：需要安装PyPDF2后才能验证PDF内容"

echo ""
echo "=== 检查证据文件中的markdown符号 ==="
grep -n "```json\|```\|\*\*\|#\|>" outputs/stage1/*.txt | wc -l
```

**预期结果**:
- ✅ 证据文件中不应包含markdown符号
- ✅ PDF中不应包含markdown符号

**测试结果**: ⏸️ 待执行

**状态**: ⚠️ 需要执行

---

### 测试2.3：PDF文件版本验证

**测试目的**: 验证最终版本的PDF是否是正确的版本

**测试步骤**:
```bash
cd financial_case_generator_system
ls -lh outputs/*.pdf | grep -E "最终|新|V58|最终版|最新" | tail -5

echo ""
echo "=== 检查所有PDF文件 ==="
ls -lt outputs/*.pdf | tail -10
```

**预期结果**:
- ✅ 应该有"完整测试卷宗_最终版.pdf"
- ✅ 或者"完整测试卷宗_最新.pdf"
- ✅ 文件大小应该合理

**测试结果**: ⏸️ 待执行

**状态**: ⚠️ 需要执行

---

## 三、标准答案集测试

### 测试3.1：标准答案集JSON验证

**测试目的**: 验证标准答案集JSON是否完整生成

**测试步骤**:
```bash
cd financial_case_generator_system
python3 -c "
import json
from pathlib import Path

# 读取标准答案集JSON
answer_key_path = Path('outputs/标准答案集.json')
if not answer_key_path.exists():
    print('标准答案集JSON不存在')
    sys.exit(1)

data = json.loads(answer_key_path.read_text(encoding='utf-8'))

print('=== 标准答案集JSON结构 ===')
print('Keys:', list(data.keys()))

print()
print('=== 各部分内容检查 ===')
for key, value in data.items():
    print(f'{key}:')
    if isinstance(value, dict):
        print(f'  Keys: {list(value.keys())}')
        if value:
            print(f'  包含 {len(value)} 个键值对')
    elif isinstance(value, list):
        print(f'  包含 {len(value)} 个元素')
    else:
        print(f'  类型: {type(value).__name__}')
    print()

print()
print('=== 详细计算过程检查 ===')
calculations = data.get('详细计算过程', {})
print('Keys:', list(calculations.keys()))

for calc_key, calc_value in calculations.items():
    print(f'{calc_key}:')
    if isinstance(calc_value, dict):
        for sub_key, sub_value in calc_value.items():
            print(f'  {sub_key}: {sub_value}')
    print()
"
```

**预期结果**:
- ✅ 标准答案集JSON应该包含7个主要部分
- ✅ 详细计算过程应该包含逾期利息计算、违约金计算、诉讼费用计算等
- ✅ 计算过程应该显示具体数值，不是"未知"

**测试结果**: ⏸️ 待执行

**状态**: ⚠️ 需要执行

---

### 测试3.2：标准答案集PDF验证

**测试目的**: 验证标准答案集PDF是否生成

**测试步骤**:
```bash
cd financial_case_generator_system
ls -lh outputs/标准答案集*.pdf

echo ""
echo "=== 标准答案集PDF统计 ==="
ls -lh outputs/标准答案集*.pdf
```

**预期结果**:
- ✅ 应该有"标准答案集_新.pdf"
- ✅ PDF大小应该合理
- ✅ PDF应该能正常打开

**测试结果**: ⏸️ 待执行

**状态**: ⚠️ 需要执行

---

### 测试3.3：计算过程准确性验证

**测试目的**: 验证计算过程的数据是否准确

**测试步骤**:
```bash
cd financial_case_generator_system
python3 -c "
import json
from pathlib import Path

# 读取0.4关键数字清单
key_numbers = json.loads(Path('outputs/stage0/0.4_key_numbers.json').read_text(encoding='utf-8'))
# 读取标准答案集
answer_key = json.loads(Path('outputs/标准答案集.json').read_text(encoding='utf-8'))

print('=== 验证逾期利息数据 ===')
late_fee = key_numbers.get('违约相关金额', {})
print(f'  逾期租金总额: {late_fee.get(\"逾期租金总额\", {})}')
print(f'  逾期利息总额: {late_fee.get(\"逾期利息总额\", {})}')
print(f'  计算方式: {late_fee.get(\"违约金计算方式\", \"\")}')

print()
print('=== 验证判决金额数据 ===')
judgment = key_numbers.get('判决金额', {})
print(f'  本金金额: {judgment.get(\"本金金额\", {})}')
print(f'  利息金额: {judgment.get(\"利息金额\", {})}')
print(f'  违约金金额: {judgment.get(\"违约金金额\", {})}')
print(f'   诉讼费用: {judgment.get(\"诉讼费用\", {})}')
print(f'  合计: {judgment.get(\"合计\", {})}')
"
```

**预期结果**:
- ✅ 逾期利息应该有明确的数值
- ✅ 判决金额应该有明确的数值
- ✅ 计算过程应该与判决书中的描述一致

**测试结果**: ⏸️ 待执行

**状态**: ⚠️ 需要执行

---

## 四、全自动执行测试

### 测试4.1：执行脚本自动执行验证

**测试目的**: 验证run_full_regeneration.py能否自动执行，无需人工干预

**测试步骤**:
```bash
cd financial_case_generator_system

# 检查是否有input()交互语句
echo "=== 检查交互式确认 ==="
grep -n "input(" run_full_regeneration.py
if [ $? -eq 0 ]; then
    echo "❌ 发现交互式确认，不符合要求"
else
    echo "✅ 未发现交互式确认，符合要求"
fi

echo ""
echo "=== 检查命令行参数支持 ==="
grep -n "argparse\|--stages\|--pdf\|--answer-key" run_full_regeneration.py | head -10
if [ $? -eq 0 ]; then
    echo "✅ 有命令行参数支持"
else
    echo "❌ 没有命令行参数支持"
fi
```

**预期结果**:
- ✅ 不应该有任何 `input()` 交互语句
- ✅ 应该支持 `--stages`、`--pdf`、`--answer-key` 参数

**测试结果**: ⏸️ 待执行

**状态**: ⚠️ 需要执行

---

### 测试4.2：命令行参数功能测试

**测试目的**: 验证命令行参数是否正常工作

**测试步骤**:
```bash
cd financial_case_generator_system

# 测试--stages参数
echo "=== 测试 --stages 参数 ==="
python3 run_full_regeneration.py --stages 0

# 测试--pdf参数
echo "=== 测试 --pdf参数 ==="
python3 run_full_regeneration.py --stages 0 --no-pdf

# 测试--answer-key参数
echo "=== 测试 --answer-key参数 ==="
python3 run_full_regeneration.py --stages 0 --answer-key

# 测试组合参数
echo "=== 测试组合参数 ==="
python3 run_full_regeneration.py --stages 0,1 --answer-key --pdf
```

**预期结果**:
- ✅ `--stages 0`: 只执行阶段0
- ✅ `--no-pdf`: 不生成PDF
- ✅ `--answer-key`: 生成标准答案集
- ✅ 组合参数应该正确解析

**测试结果**: ⏸️ 待执行

**状态**: ⚠️ 需要执行

---

## 五、代码质量测试

### 测试5.1：Python代码语法检查

**测试目的**: 检查Python文件是否有语法错误

**测试步骤**:
```bash
cd financial_case_generator_system

echo "=== 检查主要Python文件的语法 ==="
python3 -m py_compile src/utils/pdf_generator.py
python3 -m py_compile src/utils/pdf_generator_simple.py
python3 -m py_compile src/services/evidence_file_generator.py
python3 -m py_compile src/services/answer_key_generator.py
python3 -m py_compile src/services/stage1/stage1_service.py
python3 -m py_compile src/services/stage2/stage2_service.py
python3 -m py_compile src/services/stage3/stage3_service.py
python3 -m py_compile run_full_regeneration.py

if [ $? -eq 0 ]; then
    echo "✅ 所有Python文件语法检查通过"
else
    echo "❌ 发现Python语法错误"
fi
```

**预期结果**:
- ✅ 所有Python文件应该通过语法检查
- ❌ 如有错误，需要修复

**测试结果**: ⏸️ 待执行

**状态**: ⚠️ 需要执行

---

### 测试5.2：导入依赖测试

**测试目的**: 验证所有依赖是否正确导入

**测试步骤**:
```bash
cd financial_case_generator_system

echo "=== 测试reportlab导入 ==="
python3 -c "
try:
    from reportlab.pdfgen import canvas
    print('✅ reportlab.pdfgen 导入成功')
except ImportError as e:
    print(f'❌ reportlab导入失败: {e}')

echo ""
echo "=== 测试LLM客户端导入 ==='
python3 -c "
try:
    from src.utils import LLMClient
    print('✅ LLMClient 导入成功')
except ImportError as e:
    print(f'❌ LLMClient 导入失败: {e}')

echo ""
echo "=== 测试PDF生成器导入 ==='
python3 -c "
try:
    from src.utils.pdf_generator import PDFGenerator
    print('✅ PDFGenerator 导入成功')
except ImportError as e:
    print(f'❌ PDFGenerator 导入失败: {e}')
"
```

**预期结果**:
- ✅ 所有依赖应该能正确导入
- ❌ 如有导入失败，需要安装缺失的依赖

**测试结果**: ⏸️ 待执行

**状态**: ⚠️ 需要执行

---

## 六、集成测试

### 测试6.1：端到端完整流程测试

**测试目的**: 验证从输入判决书到生成PDF的完整流程是否正常

**测试步骤**:
```bash
cd financial_case_generator_system

echo "=== 端到端测试 ==="
python3 run_full_regeneration.py

echo ""
echo "=== 检查所有生成文件 ==="
ls -lh outputs/stage0/*.json outputs/stage1/*.txt outputs/stage1/*.pdf outputs/stage2/*.json outputs/stage2/*.txt outputs/stage2/*.pdf outputs/stage3/*.json outputs/stage3/*.pdf outputs/*.pdf 2>/dev/null || echo "部分文件未生成"

echo ""
echo "=== 统计文件数量 ==="
echo "阶段0文件数:" $(ls outputs/stage0/*.json 2>/dev/null | wc -l)
echo "阶段1文件数:" $(ls outputs/stage1/*.txt outputs/stage1/*.pdf 2>/dev/null | wc -l)
echo "PDF文件数:" $(ls outputs/*.pdf 2>/dev/null | wc -l)
echo "JSON文件数:" $(ls outputs/**/*.json 2>/dev/null | wc -l)"
```

**预期结果**:
- ✅ 所有文件都应该成功生成
- ✅ 文件数量应该合理
- ✅ 没有错误信息

**测试结果**: ⏸️ 待执行

**状态**: ⚠️ 需要执行

---

## 七、已知问题验证

### 问题1：证据包生成不完整

**问题描述**: 根据之前的测试报告，只生成了1个证据组，应该生成8个

**验证方法**:
```bash
cd financial_case_generator_system

python3 -c "
import json
from pathlib import Path

# 检查plaintiff_package.json中的证据组数量
data = json.loads(Path('outputs/stage1/plaintiff_package.json').read_text(encoding='utf-8'))
evidence_package = data.get('证据包', {})

print('plaintiff_package.json中的证据组数量:', len(evidence_package))
print('证据组Keys:', list(evidence_package.keys()))

# 检查0.5证据归属规划表
planning = json.loads(Path('outputs/stage0/0.5_evidence_planning.json').read_text(encoding='utf-8'))
plaintiff_evidence = [e for e in planning['证据归属规划表'] if e['应归属方'] == '原告']

# 统计证据组
evidence_groups = {}
for evidence in plaintiff_evidence:
    group_id = evidence.get('证据组', 1)
    if group_id not in evidence_groups:
        evidence_groups[group_id] = []
    evidence_groups[group_id].append(evidence)

print()
print('0.5中原告证据组数量:', len(evidence_groups))
for group_id in sorted(evidence_groups.keys()):
    count = len(evidence_groups[group_id])
    print(f'  证据组{group_id}: {count} 个证据')
"
```

**预期结果**:
- ❌ 应该生成8个证据组，但实际只生成了1个
- ✅ 0.5证据归属规划表中确实有8个证据组

**验证状态**: ⏸️ 待执行

**状态**: ⚠️ 已确认需要修复

---

### 问题2：计算过程显示"未知"

**问题描述**: 标准答案集中的计算过程显示"未知"，数据提取有问题

**验证方法**:
```bash
cd financial_case_generator_system

python3 -c "
import json
from pathlib import Path

# 检查标准答案集的计算过程
answer_key = json.loads(Path('outputs/标准答案集.json').read_text(encoding='utf-8'))
calculations = answer_key.get('详细计算过程', {})

print('=== 检查逾期利息计算 ===')
interest_calc = calculations.get('逾期利息计算', {})
for key, value in interest_calc.items():
    print(f'{key}: {value}')

print()
print('=== 检查违约金计算 ==='
penalty_calc = calculations.get('违约金计算', {})
for key, value in penalty_calc.items():
    print(f'{key}: {value}')

print()
print('=== 检查诉讼费用计算 ===')
litigation_calc = calculations.get('诉讼费用计算', {})
for key, value in litigation_calc.items():
    print(f'{key}: {value}')
"
```

**预期结果**:
- ❌ 计算基数、利率、计算公式应该显示具体数值
- ✅ 应该根据0.4关键数字清单提取数据

**验证状态**: ⏸️ 待执行

**状态**: ⚠️ 已确认需要修复

---

### 问题3：新架构未实现

**问题描述**: 我们的规划中建议每个证据单独一个文件，但实际并未按此方式实现

**验证方法**:
```bash
cd financial_case_generator_system

echo "=== 检查是否按照新架构实现 ==="
echo "1. 检查是否有evidence_index.json"
if [ -f "outputs/stage1/evidence_index.json" ]; then
    echo "✅ 存在evidence_index.json（新架构）"
    python3 -c "
import json
from pathlib import Path
    data = json.loads(Path('outputs/stage1/evidence_index.json').read_text(encoding='utf-8'))
    print('Keys:', list(data.keys()))
    print('证据总数:', data.get('证据总数', '未知'))
    print('证据列表数量:', len(data.get('证据列表', [])))
else
    echo "❌ 不存在evidence_index.json（新架构未实现）"
fi

echo ""
echo "2. 检查是否有evidence/目录"
if [ -d "outputs/stage1/evidence" ]; then
    echo "✅ 存在evidence/目录（新架构）"
    echo "证据文件数:"
    ls outputs/stage1/evidence/*.txt 2>/dev/null | wc -l
else
    echo "❌ 不存在evidence/目录（新架构未实现）"
fi

echo ""
echo "3. 检查证据文件命名是否符合新规范"
if [ -d "outputs/stage1/evidence" ]; then
    echo "证据文件列表:"
    ls outputs/stage1/evidence/*.txt
    echo ""
    echo "检查命名规范（格式：证据组X_E00X_证据名称.txt）:"
    ls outputs/stage1/evidence/*.txt | grep -v "^证据组[1-8]_" | head -5
fi
```

**预期结果**:
- ❌ 应该有evidence_index.json但实际没有
- ❌ 应该有evidence/目录但实际没有
- ✅ 仍然使用旧的证据包方式（原告证据包_证据组1.txt）

**验证状态**: ⏸️ 已确认需要按照新架构重构

**状态**: ⚠️ 已确认需要重构

---

## 八、性能测试

### 测试8.1：文件生成速度测试

**测试目的**: 测试单个证据文件生成速度

**测试步骤**:
```bash
cd financial_case_generator_system

echo "=== 测试单个证据文件生成速度 ==="
time python3 -c "
from pathlib import Path
import time

# 测试读取已有文件的速度
evidence_files = list(Path('outputs/stage1').glob('原告证据包_*.txt'))
if evidence_files:
    file = evidence_files[0]
    start = time.time()
    content = file.read_text(encoding='utf-8')
    end = time.time()
    print(f'读取文件 ({file.name}):\n  文件大小: {len(content)} 字符\n  耗时: {end - start:.3f} 秒\n')
else:
    print('未找到证据文件')
"
```

**预期结果**:
- ✅ 读取速度应该很快（< 1秒）
- ✅ 不应该有明显延迟

**测试结果**: ⏸️ 待执行

**状态**: ⏸️ 待执行

---

### 测试8.2：PDF生成速度测试

**测试目的**: 测试PDF生成速度

**测试步骤**:
```bash
cd financial_case_generator_system

echo "=== 测试PDF生成速度 ==="
# 需要重新生成PDF来测试，暂时跳过
echo "注意：需要在重新生成时测试"
```

**预期结果**:
- ✅ PDF生成速度应该合理（每个文件 < 10秒）
- ✅ 不应该有明显卡顿

**测试结果**: ⏸️ 待执行

**状态**: ⏸️ 待执行

---

## 九、回归测试

### 测试9.1：重复执行测试

**测试目的**: 验证系统重复执行是否稳定

**测试步骤**:
```bash
cd financial_case_generator_system

echo "=== 第一次执行 ==="
time python3 run_full_regeneration.py --stages 0
echo ""

echo "=== 第二次执行 ==="
time python3 run_full_regeneration.py --stages 0
echo ""

echo "=== 第三次执行 ==="
time python3 run_full_regeneration.py --stages 0
```

**预期结果**:
- ✅ 三次执行的结果应该一致
- ✅ 不应该有随机性差异
- ✅ 文件覆盖/更新机制应该正确

**测试结果**: ⏸️ 待执行

**状态**: ⏸️ 待执行

---

## 十、Bug修复验证测试

### 测试10.1：新架构实施验证

**测试目的**: 验证新架构是否按照规划实施

**测试步骤**:
```bash
cd financial_case_generator_system

echo "=== 新架构实施验证 ==="

echo "1. 检查新文件 ==="
echo "   - src/utils/pdf_generator_simple.py"
echo "   - src/services/evidence_file_generator.py"
echo "   - prompts/stage1/1.2.1_单个证据生成.md"

# 检查文件是否存在
for file in \
    "src/utils/pdf_generator_simple.py" \
    "src/services/evidence_file_generator.py" \
    "prompts/stage1/1.2.1_单个证据生成.md"
do
    if [ -f "$file" ]; then
        echo "✅ 存在: $file"
    else
        echo "❌ 不存在: $file"
    fi
done

echo ""
echo "2. 检查旧文件是否保留 ==="
echo "   - src/utils/pdf_generator.py"
echo "   - src/utils/pdf_generator_backup.py"

for file in \
    "src/utils/pdf_generator.py" \
    "src/utils/pdf_generator_backup.py"
do
    if [ -f "$file" ]; then
        echo "✅ 存在: $file"
    else
        echo "❌ 不存在: $file"
fi
```

**预期结果**:
- ✅ 应该有新的pdf_generator_simple.py
- ✅ 应该有evidence_file_generator.py
- ✅ 旧版pdf_generator.py应该保留为备份

**测试结果**: ⏸️ 待执行

**状态**: ⏸️ 待执行

---

## 十一、兼容性测试

### 测试11.1：旧版本功能回退测试

**测试目的**: 验证新架构不影响旧功能

**测试步骤**:
```bash
cd financial_case_generator_system

echo "=== 检查旧版本功能是否保留 ==="

# 检查是否还能使用旧方式生成
echo "检查旧版PDF生成器..."
python3 -c "
try:
    from src.utils.pdf_generator import PDFGenerator
    print('✅ 旧版PDF生成器可用')
except ImportError as e:
    print(f'❌ 旧版PDF生成器不可用: {e}')
"

echo ""
echo "检查旧版证据包生成器..."
python3 -c "
try:
    # 尝试使用旧的证据包生成方式
    from src.services.stage1.stage1_service import Stage1Service
    print('✅ 旧版Stage1Service可用')
except ImportError as e:
    print(f'❌ 旧版Stage1Service不可用: {e}')
"
```

**预期结果**:
- ✅ 旧版PDF生成器应该仍然可用
- ✅ 旧版Stage1Service应该仍然可用
- ✅ 新旧两个版本可以共存

**测试结果**: ⏸️ 待执行

**状态**: ⏸️ 待执行

---

## 测试执行清单

### 短期任务（必须完成）

#### 第1批：证据包生成测试
- [ ] 测试1.1：证据组数量验证
- [ ] 测试1.2：证据文件内容验证
- [ ] 测试1.3：证据组完整性验证

#### 第2批：PDF生成测试
- [ ] 测试2.1：PDF文件验证
- [ ] 测试2.2：PDF内容验证
- [ ] 测试2.3：PDF文件版本验证

#### 第3批：标准答案集测试
- [ ] 测试3.1：标准答案集JSON验证
- [ ] 测试3.2：标准答案集PDF验证
- [ ] 测试3.3：计算过程准确性验证

#### 第4批：全自动执行测试
- [ ] 测试4.1：执行脚本自动执行验证
- [ ] 测试4.2：命令行参数功能测试
- [ ] 测试4.3：参数组合测试

#### 第5批：代码质量测试
- [ ] 测试5.1：Python代码语法检查
- [ ] 测试5.2：导入依赖测试

#### 第6批：集成测试
- [ ] 测试6.1：端到端完整流程测试
- [ ] 测试6.2：文件统计验证

#### 第7批：已知问题验证
- [ ] 验证问题1：证据包生成不完整
- [ ] 验证问题2：计算过程显示"未知"
- [ ] 验证问题3：新架构未实现

#### 第8批：新架构实施验证
- [ ] 测试11.1：新架构文件检查
- [ ] 测试11.2：旧版本功能回退测试

#### 第9批：性能测试
- [ ] 测试8.1：文件生成速度测试
- [ ] 测试8.2：PDF生成速度测试

#### 第10批：回归测试
- [ ] 测试9.1：重复执行测试
- [ ] 测试11.1：兼容性测试

---

## 测试记录模板

### 单个测试用例记录

```markdown
## 测试用例：[编号]

**测试人员**: opencode
**测试日期**: 2026-01-21
**测试环境**: macOS
**测试版本**: v1.0.3-alpha

### 测试目标
[简要说明测试目标]

### 执行步骤
[1. 步骤1：xxx]
[2. 步骤2：xxx]

### 执行结果
| 测试项 | 预期结果 | 实际结果 | 状态 |
|--------|----------|----------|------|
| xxxxx | ✅/❌ | ✅/❌ | ✅/⚠️ |

### 发现的问题
- [ ] 问题1：xxx
- [ ] 问题2：xxx

### 建议修复措施
- [ ] 建议1：xxx
- [ ] 建议2：xxx

### 备注
[自由记录其他观察和问题]
```

---

## 测试报告模板

```markdown
# 金融案件测试数据生成系统 - 测试报告

## 测试概览
- 测试日期: 2026-01-21
- 测试版本: v1.0.3-alpha
- 测试人员: opencode
- 测试环境: macOS

## 测试范围
- A. 证据包生成测试（3个测试）
- B. PDF生成测试（3个测试）
- C. 标准答案集测试（3个测试）
- D. 全自动执行测试（2个测试）
- E. 代码质量测试（2个测试）
- F. 集成测试（1个测试）
- G. 已知问题验证（3个测试）
- H. 新架构实施验证（1个测试）
- I. 性能测试（2个测试）
- J. 回归测试（2个测试）
- K. 兼容性测试（1个测试）

## 测试结果汇总
- 总测试用例数: 22
- 通过: X
- 失败: Y
- 跳过: X
- 阻塞: X

## 发现的问题统计
- 高优先级: X
- 中优先级: Y
- 低优先级: Z

## 修复建议
- 立即修复: X项问题
- 短期修复: Y项问题
- 长期优化: Z项问题

## 下一步行动
1. 根据测试结果更新代码
2. 重新测试修复后的功能
3. 准备下一轮测试

---

**测试报告完成日期**: 2026-01-21
**下次更新**: 根据测试进度更新
