# 开发调整规划 - 快速总结

## 调整目标（3个）

### 1. ✅ 去掉交互式确认，实现全自动执行
**现状**：每个阶段都要用户确认 `input("是否继续执行...？")`
**目标**：完全自动化，单条命令执行到底
**方式**：移除所有input()，支持命令行参数控制

---

### 2. ✅ 整合生成到一份完整的PDF
**现状**：生成一堆.txt/.json文件，包含markdown符号
**目标**：生成一份专业格式的PDF卷宗
**要求**：
- 去除markdown符号（```、**、#、`、>等）
- 按法院卷宗顺序组织
- 符合法律文书格式规范

**PDF内容结构**：
```
完整测试卷宗.pdf
├─ 封面
├─ 目录
├─ 第一部分：原告起诉包
│   ├─ 1.1 民事起诉状
│   ├─ 1.2 原告证据包（所有证据组）
│   └─ 1.3 原告程序性文件
├─ 第二部分：被告答辩包
│   ├─ 2.1 民事答辩状
│   ├─ 2.2 被告证据包
│   └─ 2.3 被告程序性文件
└─ 第三部分：法院审理包
    ├─ 3.1 庭审笔录
    └─ 3.2 判决书（脱敏版）
```

---

### 3. ✅ 生成标准答案集PDF（参考文档）
**现状**：只有卷宗文件，没有标准答案
**目标**：生成包含诉求、准确金额、计算过程的标准答案集
**用途**：快速核对生成的卷宗是否准确

**标准答案集内容结构**：
```
标准答案集.pdf
├─ 一、案件基本信息
├─ 二、原告诉讼请求（详细）
├─ 三、被告抗辩意见（详细）
├─ 四、关键金额清单
│   ├─ 4.1 合同基础金额
│   ├─ 4.2 租金安排
│   ├─ 4.3 租金支付计划
│   ├─ 4.4 违约相关金额
│   ├─ 4.5 诉讼费用
│   └─ 4.6 判决金额
├─ 五、详细计算过程 ⭐核心
│   ├─ 5.1 逾期利息计算（公式+过程+结果）
│   ├─ 5.2 违约金计算（公式+过程+结果）
│   └─ 5.3 诉讼费用计算（公式+过程+结果）
├─ 六、法院认定
└─ 七、关键时间线
```

---

## 技术方案

### 方案1：去掉交互式确认
- 移除所有 `input()` 语句
- 支持命令行参数：`--stages 0,1,2,3`
- 默认执行所有阶段

### 方案2：PDF生成（使用reportlab）
- 优势：Python原生，功能强大，中文支持好
- 需要配置：中文字体、页面设置、章节格式
- 清理规则：去除所有markdown符号

### 方案3：标准答案集生成
- 从阶段0数据自动提取
- 生成详细计算过程（公式+过程+结果）
- 同样使用reportlab生成PDF

---

## 实施步骤（5个阶段）

### 第一阶段：去掉交互式确认
**时间**：0.5小时
**任务**：
- [ ] 修改 `run_full_regeneration.py`
- [ ] 修改 `test_with_judgment_improved.py`
- [ ] 移除所有input()语句
- [ ] 添加命令行参数支持

### 第二阶段：实现PDF生成器
**时间**：2-3小时
**任务**：
- [ ] 安装reportlab依赖
- [ ] 创建 `src/utils/pdf_generator.py`
- [ ] 实现基础PDF生成功能
- [ ] 实现markdown清理功能
- [ ] 实现内容添加方法

### 第三阶段：实现标准答案集生成器
**时间**：2-3小时
**任务**：
- [ ] 创建 `src/services/answer_key_generator.py`
- [ ] 实现数据提取方法
- [ ] 实现计算过程生成
- [ ] 生成标准答案集内容

### 第四阶段：集成到主流程
**时间**：1-2小时
**任务**：
- [ ] 集成PDF生成到 `run_full_regeneration.py`
- [ ] 集成标准答案集生成
- [ ] 添加命令行参数控制
- [ ] 测试完整流程

### 第五阶段：测试和优化
**时间**：1-2小时
**任务**：
- [ ] 测试全自动执行
- [ ] 测试PDF生成（格式、中文、排版）
- [ ] 测试标准答案集（准确性、完整性）
- [ ] 优化和调整

**总预计时间**：7-10.5小时（1-1.5个工作日）

---

## 文件清单

### 新建文件
```
src/utils/pdf_generator.py          # PDF生成器
src/services/answer_key_generator.py # 标准答案集生成器
```

### 修改文件
```
run_full_regeneration.py             # 去掉交互，集成PDF生成
test_with_judgment_improved.py       # 去掉交互
requirements.txt                    # 添加reportlab依赖
```

### 生成文件
```
outputs/完整测试卷宗.pdf             # 专业格式PDF
outputs/标准答案集.pdf              # 参考文档PDF
```

---

## 使用方式（调整后）

### 方式1：全自动执行（默认）
```bash
python run_full_regeneration.py
```

**执行流程**：
1. 读取判决书
2. 执行阶段0（解析）
3. 执行阶段1（原告起诉包）
4. 执行阶段2（被告答辩包）
5. 执行阶段3（法院审理包）
6. 生成完整测试卷宗PDF ⭐
7. 生成标准答案集PDF ⭐

**无需任何确认！**

### 方式2：指定执行阶段
```bash
# 只执行阶段0
python run_full_regeneration.py --stages 0

# 执行阶段0和1
python run_full_regeneration.py --stages 0,1

# 执行阶段1和2
python run_full_regeneration.py --stages 1,2
```

---

## 依赖更新

```
requirements.txt 新增：
reportlab==4.0.7    # PDF生成（Python原生，功能强大）
```

---

## 详细规划

完整的详细规划请查看：
`开发调整规划-去除交互、整合PDF、生成标准答案集.md`

---

**总结**：
- ✅ 3个调整目标明确
- ✅ 技术方案可行
- ✅ 实施步骤清晰
- ✅ 时间估算合理（7-10.5小时）
- ✅ 文件清单完整

可以交给开发会话执行了！
