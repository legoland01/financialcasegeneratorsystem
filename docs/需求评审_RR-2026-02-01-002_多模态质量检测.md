# 需求评审文档：多模态质量检测

**评审编号**: RR-2026-02-01-002
**评审日期**: 2026-02-01
**评审人**: Agent2 (开发)
**需求版本**: TD-2026-02-01-003 v1.0
**状态**: 待签署

---

## 一、评审概述

### 1.1 评审目标

审核 `需求文档_多模态质量检测_TD-2026-02-01-003.md` 的完整性和可实施性。

### 1.2 需求背景

**核心问题**: 文本检测无法识别的布局问题需要多模态模型检测

| 问题类型 | 示例 | 当前检测 |
|---------|------|---------|
| 文本问题 | 某某设备、若干台 | pdftotext + 正则 ✅ |
| **布局问题** | 留白、回车、表格、编号断裂 | **需要多模态** ❌ |

---

## 二、需求分析

### 2.1 功能需求对照

| 需求编号 | 功能描述 | 优先级 | 实现难度 | 建议 |
|---------|---------|--------|---------|------|
| MR-001 | 使用Qwen-VL-Max分析PDF布局 | P0 | 中 | ✅ 采用 |
| MR-002 | 检测条款编号连续性 | P0 | 低 | ✅ 采用 |
| MR-003 | 检测异常留白 | P1 | 低 | ✅ 采用 |
| MR-004 | 检测回车位置正确性 | P1 | 中 | ✅ 采用 |
| MR-005 | 检测表格格式 | P1 | 中 | ⚠️ 建议延后 |

### 2.2 非功能需求

| 需求编号 | 描述 | 评估 |
|---------|------|------|
| NFR-001 | 单次分析响应时间 < 30秒 | ✅ 可达成 |
| NFR-002 | API成本 < ¥0.05/次 | ✅ SiliconFlow Qwen-VL-Max较便宜 |
| NFR-003 | 支持SiliconFlow API | ✅ 已支持 |

---

## 三、技术方案评审

### 3.1 技术选型合理性

| 组件 | 选择 | 评审意见 |
|------|------|---------|
| 多模态模型 | Qwen-VL-Max | ✅ SiliconFlow可用，成本可控 |
| PDF处理 | PyMuPDF | ✅ Fitz库已用于PDF生成，兼容 |
| API | SiliconFlow | ✅ 用户指定，无需额外适配 |

### 3.2 接口设计评审

**当前设计**:
```python
class MultimodalQA:
    def analyze_pdf_layout(self, pdf_path: str) -> Dict
```

**评审意见**:
- ✅ 接口简洁清晰
- ⚠️ 建议增加 `image_quality` 参数控制PDF转图片质量
- ⚠️ 建议增加 `max_pages` 参数限制分析页数（成本控制）

**建议改进**:
```python
def analyze_pdf_layout(
    self,
    pdf_path: str,
    max_pages: int = 5,
    image_dpi: int = 150
) -> Dict
```

---

## 四、实现可行性分析

### 4.1 依赖检查

| 依赖 | 当前状态 | 说明 |
|------|---------|------|
| PyMuPDF | ✅ 已安装 | 用于PDF生成 |
| requests | ✅ 已安装 | HTTP客户端 |
| python-dotenv | ✅ 已安装 | 环境变量管理 |

### 4.2 已有代码参考

| 组件 | 路径 | 可复用性 |
|------|------|---------|
| SiliconFlow API调用 | `src/utils/llm.py` | ✅ 参考API调用模式 |
| PDF处理 | `src/renderer/` | ✅ 参考PDF操作 |

### 4.3 开发工作量估算

| 任务 | 复杂度 | 预估工时 |
|------|--------|---------|
| MultimodalQA类实现 | 中 | 4小时 |
| SiliconFlow API集成 | 低 | 2小时 |
| 条款编号检测Prompt | 低 | 1小时 |
| 留白/回车检测Prompt | 中 | 2小时 |
| 测试用例编写 | 低 | 2小时 |
| **合计** | - | **约11小时** |

---

## 五、问题与风险

### 5.1 必须解决

| # | 问题 | 严重程度 | 建议 |
|---|------|---------|------|
| 1 | Prompt设计未给出具体模板 | **高** | 需在详细设计中补充 |
| 2 | 降级策略未明确 | **中** | 明确API失败时的处理 |

### 5.2 潜在风险

| 风险 | 影响 | 应对措施 |
|------|------|---------|
| Qwen-VL-Max对中文合同理解能力 | 中 | 提前测试Prompt效果 |
| API限流 | 低 | 添加重试机制 |
| PDF转图片质量 | 低 | 使用150-200 DPI |

---

## 六、验收标准评审

### 6.1 当前验收标准

```markdown
- [ ] 能检测到用户反馈的条款编号断裂问题
- [ ] 能检测到异常留白
- [ ] 能检测到回车位置错误
- [ ] 单次分析 < 30秒
- [ ] API成本 < ¥0.05/次
```

### 6.2 建议补充

| 补充项 | 原因 |
|--------|------|
| 添加假阳性率控制 | 避免过度报告问题 |
| 添加中文合同理解测试 | 验证模型对法律文本的理解能力 |
| 明确重试策略 | API调用失败时的行为 |

---

## 七、决策

| 决策项 | 决策 | 备注 |
|--------|------|------|
| 需求完整性 | ✅ 通过 | 需补充Prompt模板 |
| 技术可行性 | ✅ 通过 | 有参考代码 |
| 成本可控性 | ✅ 通过 | <¥0.05/次可达成 |
| 时间合理性 | ✅ 通过 | 约11小时 |

---

## 八、签署

| 角色 | 签署 | 日期 |
|------|------|------|
| 产品 (Agent1) | ______________ | ______________ |
| 开发 (Agent2) | ______________ | ______________ |

---

## 九、后续行动

| 行动项 | 负责人 | 截止日期 |
|--------|--------|---------|
| 补充详细设计文档（Prompt模板） | Agent2 | 2026-02-02 |
| 实现 MultimodalQA 类 | Agent2 | 2026-02-03 |
| 添加测试用例 | Agent1 | 2026-02-03 |
| 端到端测试 | Agent1 | 2026-02-04 |

---

**文档版本**: v1.0
**创建日期**: 2026-02-01
**最后更新**: 2026-02-01
