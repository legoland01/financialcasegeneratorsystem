# 测试用例 - v3.0 证据生成流程

**版本**: v1.0
**日期**: 2026-02-01
**来源**: PRD-2026-02-01-v3.0
**测试文件**: tests/blackbox/test_v3_evidence_flow.py, test_v3_e2e.py

---

## 一、测试文件

| 文件 | 类型 | 用例数 | 位置 |
|------|------|--------|------|
| test_v3_evidence_flow.py | 黑盒测试 | 11个 | tests/blackbox/ |
| test_v3_e2e.py | E2E测试 | 3个 | tests/blackbox/ |

---

## 二、黑盒测试 (TestV3EvidenceFlow)

### TC-v3-001: 案情基本数据集只包含真实名称

| 项目 | 内容 |
|------|------|
| **测试内容** | 验证CaseData中不包含"某某公司"等脱敏标记 |
| **验证方法** | 检查原告/被告名称为真实名称 |
| **预期结果** | "东方金融租赁有限公司"、"南昌宏昌商业零售有限公司" |

### TC-v3-002: 证据列表从案情数据提取关键信息

| 项目 | 内容 |
|------|------|
| **测试内容** | EvidenceList从CaseData提取每份证据的关键信息 |
| **验证方法** | 检查合同证据包含出租人、承租人、标的物等字段 |
| **预期结果** | 关键信息完整，无脱敏标记 |

### TC-v3-003: 证据列表不包含脱敏标记

| 项目 | 内容 |
|------|------|
| **测试内容** | EvidenceList中不出现脱敏标记 |
| **验证方法** | 使用正则检测"某某"、"XX"、"某年某月某日"等 |
| **预期结果** | 无脱敏标记 |

### TC-v3-004: 证据与诉求的对应关系

| 项目 | 内容 |
|------|------|
| **测试内容** | 每份证据正确标注其支撑的诉求 |
| **验证方法** | 检查合同证据支撑"本金"诉求 |
| **预期结果** | 映射关系正确 |

### TC-v3-005: 附件规划

| 项目 | 内容 |
|------|------|
| **测试内容** | 合同类证据正确规划附件形式 |
| **验证方法** | 检查租赁物清单为"独立文件"形式 |
| **预期结果** | 附件类型和形式正确 |

### TC-v3-006: LLM Prompt只包含真实名称

| 项目 | 内容 |
|------|------|
| **测试内容** | EvidenceList转换为Prompt时只包含真实名称 |
| **验证方法** | 检查Prompt包含真实公司名称 |
| **预期结果** | Prompt中无脱敏标记 |

### TC-v3-007: 附件数据来自案情基本数据集

| 项目 | 内容 |
|------|------|
| **测试内容** | 附件数据从CaseData.attachments提取 |
| **验证方法** | 检查租赁物清单数据完整 |
| **预期结果** | 附件数据为真实信息 |

### TC-v3-008: 证据索引生成

| 项目 | 内容 |
|------|------|
| **测试内容** | EvidenceIndex正确生成证据与诉求的对应关系 |
| **验证方法** | 检查索引包含证据名称、类型、证明目的 |
| **预期结果** | 索引格式正确 |

### TC-v3-009: 金额一致性

| 项目 | 内容 |
|------|------|
| **测试内容** | 合同金额与附件金额合计一致 |
| **验证方法** | 检查合同金额 >= 附件金额合计 |
| **预期结果** | 金额逻辑正确 |

### TC-v3-010: 当事人名称一致性

| 项目 | 内容 |
|------|------|
| **测试内容** | 同一当事人名称在所有证据中一致 |
| **验证方法** | 检查原告/被告名称在各证据中一致 |
| **预期结果** | 名称完全一致 |

### TC-v3-011: 日期一致性

| 项目 | 内容 |
|------|------|
| **测试内容** | 同一事件的日期在所有证据中一致 |
| **验证方法** | 检查签约日期在各证据中一致 |
| **预期结果** | 日期完全一致 |

---

## 三、E2E测试 (TestV3EndToEnd)

### TC-v3-E2E-001: 完整证据生成流程

| 项目 | 内容 |
|------|------|
| **测试内容** | 完整流程：案情分析→证据列表→LLM生成→PDF输出 |
| **测试步骤** | 1. 案情分析<br>2. 诉求提取<br>3. 证据规划<br>4. 证据收集<br>5. 证据列表创建<br>6. LLM生成<br>7. 证据索引 |
| **预期结果** | 全流程正确执行 |

### TC-v3-E2E-002: 脱敏标记检测

| 项目 | 内容 |
|------|------|
| **测试内容** | 整个流程中不出现脱敏标记 |
| **验证方法** | 检测脱敏标记模式 |
| **预期结果** | 无脱敏标记 |

### TC-v3-E2E-003: 数据一致性验证

| 项目 | 内容 |
|------|------|
| **测试内容** | 关键数据在流程各环节保持一致 |
| **验证方法** | 检查原告名称、合同金额在各环节一致 |
| **预期结果** | 数据完全一致 |

---

## 四、核心原则覆盖

| v3.0原则 | 对应用例 |
|----------|----------|
| P1 脱敏标记隔离 | TC-v3-003, TC-v3-006, TC-v3-E2E-002 |
| P2 要素驱动 | TC-v3-001, TC-v3-002, TC-v3-E2E-001 |
| P3 附件规划 | TC-v3-005, TC-v3-007 |
| P4 数据契约 | TC-v3-004, TC-v3-008, TC-v3-E2E-003 |

---

## 五、运行测试

```bash
# 运行所有v3.0测试
python3 -m pytest tests/blackbox/test_v3_evidence_flow.py tests/blackbox/test_v3_e2e.py -v

# 运行黑盒测试
python3 -m pytest tests/blackbox/test_v3_evidence_flow.py -v

# 运行E2E测试
python3 -m pytest tests/blackbox/test_v3_e2e.py -v
```

---

**文档版本**: v1.0
**创建日期**: 2026-02-01
