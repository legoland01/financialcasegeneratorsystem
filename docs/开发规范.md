# 开发规范

**目的**: 通用开发规范，适用于所有项目  
**版本**: v1.1  
**最后更新**: 2026-01-28

---

## 1. 需求文档规范

每个项目的需求文档必须包含：

| 章节 | 必须回答的问题 |
|------|---------------|
| 核心设计原则 | 核心流程是什么？数据层级怎么分？组件边界在哪里？ |
| 功能清单 | 哪些功能要保留？哪些要新增？ |
| 验收标准 | 每个功能怎么验证？ |

---

## 2. 开发交接规范

开发开始前必须完成：

| 步骤 | 内容 |
|------|------|
| 1 | 产品经理讲解核心设计原则 |
| 2 | 逐项确认功能清单（保留/新增） |
| 3 | 逐项确认验收标准 |
| 4 | 逐项确认知识沉淀要求 |
| 5 | **开发签字确认** |

### 2.1 开发交接清单必须包含的内容

| 章节 | 必须包含的内容 | 说明 |
|------|---------------|------|
| 核心设计原则 | 核心流程、数据层级、组件边界 | 让开发快速理解设计意图 |
| 功能清单 | 保留功能列表、新增功能列表 | 防止遗漏 |
| 详细需求 | 核心组件的输入/输出格式、接口定义 | 开发必须知道怎么实现 |
| 验收标准 | 每个功能的验收条件、测试方法 | 开发必须知道怎么算完成 |
| 知识沉淀要求 | 记录规则、位置、格式 | 强制要求 |
| 签字确认 | 开发签字、日期 | 形成记录 |

### 2.2 详细需求必须包含的内容

对于每个核心组件，必须说明：

| 内容 | 说明 |
|------|------|
| 功能职责 | 组件做什么 |
| 输入格式 | JSON结构示例 |
| 输出格式 | JSON结构示例 |
| 接口定义 | 函数签名、参数、返回值 |
| 处理流程 | 流程图或步骤说明 |
| 边界条件 | 异常情况处理 |

**示例**（DataGenerator）:
```markdown
### DataGenerator 详细需求

#### 功能职责
根据边界条件自动生成设备名称、银行账号、租金计划等。

#### 输入格式
```json
{
  "judgment_hash": "abc123...",
  "boundary_conditions": {...},
  "template_library": {...},
  "force_refresh": false
}
```

#### 输出格式
```json
{
  "judgment_hash": "abc123...",
  "generated_data": {...},
  "cache_timestamp": "..."
}
```

#### 接口定义
```python
def generate(judgment_path: str, force_refresh: bool = False) -> dict:
    """
    生成详细数据
    """
```

#### 缓存机制
（流程图）
```

**知识沉淀要求**：
- 每次解决Bug后必须记录
- 不记录 = 没解决
- 代码合入前必须完成记录

---

## 3. 评审规范

设计评审必须检查：

| 检查项 |
|--------|
| 功能完整性（对照需求文档） |
| Bug解决（对照已知Bug列表） |
| 知识沉淀（每个已解决的Bug都有记录） |
| 组件边界清晰 |
| 数据流合理 |

---

## 4. 知识沉淀规范

### 4.1 什么时候记录

| 场景 | 是否需要记录 |
|------|-------------|
| 解决了一个技术难题 | ✅ 必须记录 |
| 发现并修复了一个Bug | ✅ 必须记录 |
| 做出设计决策 | ✅ 必须记录 |
| 遇到问题但没解决 | ✅ 必须记录（待解决） |

### 4.2 记录什么

每个记录必须包含：日期、问题、原因、解决方法、涉及版本、涉及代码、预防措施。

### 4.3 记录位置

| 类型 | 位置 |
|------|------|
| 项目通用经验 | 项目专属问题记录文档 |
| 代码相关经验 | 代码注释中 |
| 设计决策 | 需求文档或设计文档中 |

---

## 5. 版本记录规范

| 要求 | 说明 |
|------|------|
| CHANGELOG.md | 每个版本变更必须记录 |
| Git tags | 每个发布版本必须打tag |
| 版本号规范 | 语义化版本（v主.次.修订） |

---

## 6. 项目管理日常

### 项目经理职责（每天）

| 工作项 |
|--------|
| 代码迭代跟进（git log） |
| 问题记录核对 |
| 需求文档核对 |
| 测试报告审查 |
| 沟通记录核对 |

### 开发职责（每天）

| 工作项 |
|--------|
| 代码提交（信息清晰） |
| 问题记录（每次解决后） |
| 测试报告阅读 |
| 问题核对（24小时内回复） |

---

## 7. 文档命名规范

| 文档类型 | 命名规则 | 示例 |
|----------|---------|------|
| 需求文档 | `需求文档.md` | `需求文档.md` |
| 测试报告 | `测试报告_YYYY-MM-DD.md` | `测试报告_2026-01-27.md` |
| 问题记录 | `问题记录.md` | `问题记录.md` |
| 开发交接清单 | `开发交接清单_YYYY-MM-DD.md` | `开发交接清单_2026-01-27.md` |
| CHANGELOG | `CHANGELOG.md` | `CHANGELOG.md` |

---

## 8. 目录结构

```
项目根目录/
├── DEVELOPMENT.md              # 开发规范索引
├── CHANGELOG.md                # 版本变更记录
├── 需求文档.md                  # 主需求文档
├── 开发交接清单.md              # 开发交接checklist
├── docs/
│   ├── 开发规范.md              # 通用开发规范（本文档）
│   ├── 问题记录.md              # 项目专属问题记录
│   ├── 测试计划.md              # 测试计划
│   └── 测试报告_YYYY-MM-DD.md   # 测试报告
└── outputs/
    └── test_reports/           # 测试报告目录
```

---

## 相关文档

| 文档 | 说明 |
|------|------|
| [问题记录.md](docs/问题记录.md) | 项目专属问题记录（项目经验教训） |
| [项目经验记录.md](项目经验记录.md) | 项目专属经验教训提炼 |

---

## 9. 文档版本管理规范

### 9.1 版本号格式

所有文档使用语义化版本号：`v主版本号.次版本号.修订号`

| 版本类型 | 格式 | 触发条件 |
|----------|------|----------|
| 主版本 | vX.0 | 重大架构变更、功能重构 |
| 次版本 | vX.Y | 功能新增、重大需求变更 |
| 修订号 | vX.Y.Z | 文档修正、错误修复、措辞调整 |

### 9.2 版本更新频率

| 文档类型 | 更新频率 | 版本示例 |
|----------|----------|----------|
| 需求文档 | 重大变更时 | v2.0, v2.1 |
| 设计文档 | 重大变更时 | v1.2, v1.3 |
| 开发交接清单 | 每次交接时 | v1.0, v1.1 |
| 测试清单 | 每次测试前 | v1.0, v1.1 |
| 开发规范 | 通用规则变更时 | v1.0, v1.1 |
| 问题记录 | 持续更新（不频繁版本号） | v1.0 |
| CHANGELOG | 每次变更时 | 无版本号 |

### 9.3 版本记录要求

每个版本变更必须在文档头部更新：

```markdown
**文档版本**: vX.Y  
**状态**: 有效/已废弃  
**创建日期**: YYYY-MM-DD  
**最后更新**: YYYY-MM-DD
```

并在文档演进历史中添加记录：

```markdown
| 版本 | 日期 | 主要变更 |
|------|------|---------|
| vX.Y | YYYY-MM-DD | 变更内容描述 |
```

### 9.4 变更内容分类

| 变更类型 | 版本号递增 | 记录方式 |
|----------|------------|----------|
| 新增功能/需求 | 次版本号(Y) | 在演进历史中新增一行 |
| 功能修改/优化 | 修订号(Z) | 在演进历史中更新最新行 |
| 错误修正 | 修订号(Z) | 在演进历史中更新最新行 |
| 措辞调整/格式修正 | 修订号(Z) | 在演进历史中更新最新行 |

### 9.5 废弃文档处理

| 处理方式 | 适用场景 |
|----------|----------|
| 移动到 v1_history/ 目录 | 文档不再使用，但需保留历史版本 |
| 在状态字段标注"已废弃" | 文档暂时不使用，未来可能恢复 |
| 添加"请使用[新文档]"指引 | 文档已被新文档替代 |

---

## 10. 通用规范 vs 项目专属记录

| 类型 | 内容 | 示例 |
|------|------|------|
| 通用规范 | 普适的、可复用的规范 | "开发交接必须签字确认" |
| 项目专属记录 | 本项目的教训和经验 | "v2.0设计中遗漏了Stage 1/2/3" |

---

## 相关文档

| 文档 | 说明 |
|------|------|
| [问题记录.md](docs/问题记录.md) | 项目专属问题记录（项目经验教训） |
| [项目经验记录.md](项目经验记录.md) | 项目专属经验教训提炼 |

---

**创建日期**: 2026-01-27  
**版本**: v1.1
