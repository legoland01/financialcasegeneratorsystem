# 金融案件证据集生成系统 v2.0 - 黑盒测试报告

**测试日期**: 2026-01-29 17:42  
**测试版本**: v2.0.1  
**测试命令**: `python3 run_complete.py`  
**测试环境**: macOS + SiliconFlow API (DeepSeek-V3.2)

---

## 一、测试概述

### 1.1 测试目标
作为最终用户，调用系统命令 `python3 run_complete.py` 生成全套证据材料，全面检查输出结果。

### 1.2 测试流程
```
输入: 判决书PDF → Stage 0 → 输出产物
```

---

## 二、测试执行结果

### 2.1 Stage 0 - 判决书解析 ✅ (5/5)

| 文件 | 大小 | 状态 | 说明 |
|------|------|------|------|
| 0.1_structured_extraction.json | 9,821 bytes | ✅ | 案件信息、诉讼请求、判决结果 |
| 0.2_anonymization_plan.json | 17,869 bytes | ✅ | 人物/公司/机构Profile库 |
| 0.3_transaction_reconstruction.json | 10,231 bytes | ✅ | 交易时间线、金额信息 |
| 0.4_key_numbers.json | 15,340 bytes | ✅ | 关键数字、设备清单 |
| 0.5_evidence_planning.json | 12,293 bytes | ✅ | 证据规划、16个证据 |

**结论**: Stage 0 全部成功完成

### 2.2 民事起诉状 - 未生成 ❌

| 文件 | 状态 | 说明 |
|------|------|------|
| stage1/民事起诉状.txt | ❌ | 默认流程未生成 |

**原因**: `run_complete.py` 默认只运行 Stage 0，民事起诉状在 Stage 1 中生成。

---

## 三、数据质量检查

### 3.1 租赁物清单 ✅

| 序号 | 设备名称 | 规格型号 | 数量 | 评估价值 |
|------|----------|----------|------|----------|
| 1 | 多联机中央空调系统 | VRV VIII代 | 10套 | 45,000,000元 |
| 2 | 冷水机组 | 离心式RF1-5000 | 2套 | 25,000,000元 |
| 3 | 电梯设备 | 曳引式客梯KONIA-1000 | 4台 | 20,000,000元 |
| 4 | 配电变压器 | SCB13-2500/10 | 8台 | 20,000,000元 |
| 5 | 消防水泵 | XBD15/40 | 10套 | 15,000,000元 |
| 6 | 监控系统 | 海康威视DS-7900 | 1套 | (缺失) |
| 7 | 商场照明设备 | 飞利浦LED | 1批 | (缺失) |
| 8 | 其他附属设施 | - | 1批 | (缺失) |

**总计**: 8项设备，**125,000,000元** ❌

### 3.2 抵押物清单 ✅

| 序号 | 名称 | 评估价值 |
|------|------|----------|
| 1 | 商业房产及土地使用权 | 100,000,000元 |

### 3.3 租金支付计划 ✅

| 项目 | 值 |
|------|-----|
| 租金期数 | 24期 |
| 已付 | 2期 |
| 未付 | 22期 |
| 年利率 | 6.10% |

### 3.4 金额一致性检查 ❌

| 项目 | 值 | 状态 |
|------|-----|------|
| 租赁物总价值 | 125,000,000元 | ❌ |
| 合同金额 | 150,000,000元 | ✅ |
| 差额 | 25,000,000元 | 需要排查 |

**问题**: 租赁物金额比合同金额少 25,000,000元

---

## 四、证据规划检查

### 4.1 证据统计

| 归属方 | 数量 |
|--------|------|
| 原告 | 16个 |
| 被告 | 0个 |

### 4.2 证据组分布

| 证据组 | 数量 | 内容 |
|--------|------|------|
| 证据组1 | 5个 | 转让合同、融资租赁合同、公证书等 |
| 证据组2 | 3个 | 抵押合同、保证合同及相关文件 |
| 证据组3 | 4个 | 执行证书、委托代理合同等 |
| 证据组4 | 1个 | 咨询服务合同 |
| 证据组5 | 3个 | 租金支付凭证 |

**总计**: 5个证据组，16个证据

---

## 五、反脱敏检查 ✅

### 5.1 占位符检查

| 检查项 | 结果 |
|--------|------|
| "某某公司" | 0处 ✅ |
| "某某律师" | 0处 ✅ |
| "某某公证" | 0处 ✅ |
| "此处填写" | 0处 ✅ |

**结论**: 反脱敏功能正常，无占位符残留

---

## 六、问题清单

### 6.1 🔴 严重问题

| ID | 问题 | 说明 |
|----|------|------|
| BUG-001 | 金额不一致 | 租赁物125M < 合同金额150M (差25M) |
| BUG-002 | 设备数据缺失 | 部分设备评估价值为null |

### 6.2 🟡 中等问题

| ID | 问题 | 说明 |
|----|------|------|
| ISSUE-001 | 民事起诉状未生成 | 需要运行 `--stage1` |
| ISSUE-002 | PDF未生成 | 需要证据文件完成后生成 |

### 6.3 🟢 轻微问题

| ID | 问题 | 说明 |
|----|------|------|
| NOTE-001 | analysis_results.json路径 | 实际在 outputs/ 而非 outputs/stage0/ |

---

## 七、测试结论

### 7.1 已验证功能

| 功能 | 状态 | 说明 |
|------|------|------|
| Stage 0 判决书解析 | ✅ 全部5个子任务成功 |
| 脱敏计划生成 | ✅ 人物/公司/机构Profile完整 |
| 关键数字提取 | ⚠️ 部分数据缺失 |
| 证据规划 | ✅ 16个证据、5个证据组 |
| 反脱敏 | ✅ 无占位符残留 |

### 7.2 待验证功能

| 功能 | 状态 | 说明 |
|------|------|------|
| 民事起诉状生成 | ❌ 未执行 | 需要 `--stage1` |
| 证据文件生成 | ❌ 未执行 | 需要 `--stage1` |
| PDF生成 | ❌ 未执行 | 需要完整Stage 1 |
| 完整卷宗 | ❌ 未执行 | 需要全部流程 |

### 7.3 总体评估

| 评估项 | 结果 |
|--------|------|
| Stage 0核心功能 | ✅ 正常 |
| 数据正确性 | ⚠️ 有问题 (金额不一致) |
| 反脱敏功能 | ✅ 通过 |
| 证据规划 | ✅ 通过 |
| 完整流程 | ❌ 未完成 |

---

## 八、后续行动

### 8.1 立即修复

1. **修复金额不一致问题** (开发团队)
   - 检查 0.4_key_numbers.json 生成逻辑
   - 确保租赁物金额 = 合同金额 (150,000,000元)

2. **修复设备数据缺失** (开发团队)
   - 检查设备评估价值字段
   - 确保所有设备有有效金额

### 8.2 完整测试

要完成完整测试，需要运行：

```bash
# 完整流程 (Stage 0 + Stage 1)
python3 run_complete.py --stage1

# 然后生成PDF (如果需要)
# 注意: 当前代码中 --stage1 不会生成PDF
```

### 8.3 代码问题

当前 `run_complete.py` 的逻辑：

| 命令 | Stage 0 | Stage 1 | PDF |
|------|---------|---------|-----|
| `python3 run_complete.py` | ✅ | ❌ | ✅* |
| `python3 run_complete.py --stage0` | ✅ | ❌ | ❌ |
| `python3 run_complete.py --stage1` | ✅ | ✅ | ❌ |

*PDF生成需要证据文件，但证据文件在Stage 1中生成

**建议**: 添加 `--all` 参数或修复逻辑，使 `python3 run_complete.py` 能运行完整流程。

---

## 九、生成文件清单

```
outputs/
├── stage0/
│   ├── 0.1_structured_extraction.json (9KB)
│   ├── 0.2_anonymization_plan.json (17KB)
│   ├── 0.3_transaction_reconstruction.json (10KB)
│   ├── 0.4_key_numbers.json (15KB)
│   └── 0.5_evidence_planning.json (12KB)
└── (无其他文件)
```

---

**报告创建**: 2026-01-29  
**版本**: v1.0  
**状态**: 部分完成 (Stage 0 ✅, Stage 1 ❌)

---

## 附录A: 测试命令历史

| 时间 | 命令 | 结果 |
|------|------|------|
| 17:42 | `python3 run_complete.py` | Stage 0完成, PDF失败 |
| - | `python3 run_complete.py --stage1` | 超时 |
| - | `python3 run_complete.py --stage0` | 仅Stage 0 |

## 附录B: 关键数据值

| 项目 | 值 |
|------|-----|
| 合同金额 | 150,000,000元 |
| 租赁物价值 | 125,000,000元 |
| 抵押物价值 | 100,000,000元 |
| 租金期数 | 24期 |
| 年利率 | 6.10% |
| 证据数量 | 16个 |
| 证据组 | 5组 |
