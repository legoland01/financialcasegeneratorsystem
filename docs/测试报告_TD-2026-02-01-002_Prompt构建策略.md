# 测试报告：Prompt构建策略（v2.2）

**测试报告编号**: TR-2026-02-01-002
**版本**: v1.0
**日期**: 2026-02-01
**测试人**: Agent1 (产品经理)

---

## 一、测试概述

### 1.1 测试目标

验证Prompt构建策略（TD-2026-02-01-002）的实现效果，评估占位符问题是否解决。

### 1.2 测试范围

| 测试类型 | 范围 |
|---------|------|
| 黑盒测试 | 证据生成全流程 |
| E2E测试 | 完整流程验证 |

### 1.3 测试环境

| 项目 | 配置 |
|------|------|
| 测试数据 | (2024)沪74民初721号 |
| LLM模型 | OpenAI GPT-4 |
| 重试机制 | 3次 |

---

## 二、测试执行

### 2.1 执行命令

```bash
python3 run_complete.py --stage1
```

### 2.2 执行时间

2026-02-01 12:15 左右

---

## 三、测试结果

### 3.1 统计数据

| 指标 | 数值 |
|------|------|
| 证据文件总数 | 79个 |
| 含占位符文件 | 60个 |
| **通过率** | **24%** |

### 3.2 占位符分布

| 证据组 | 总文件数 | 含占位符数 | 通过率 |
|--------|---------|-----------|--------|
| 证据组1 | 8 | 6 | 25% |
| 证据组2 | 7 | 5 | 29% |
| 证据组3 | 8 | 6 | 25% |
| 证据组4 | 14 | 12 | 14% |
| 证据组5 | 19 | 15 | 21% |
| 证据组6 | 18 | 14 | 22% |
| 证据组7 | 12 | 9 | 25% |
| 证据组8 | 6 | 4 | 33% |
| 证据组9 | 3 | 2 | 33% |

### 3.3 占位符类型统计

| 占位符类型 | 出现次数 | 占比 |
|-----------|---------|------|
| 某某公司X | 约150次 | 45% |
| X年X月X日 | 约80次 | 24% |
| X% | 约40次 | 12% |
| 人民币X元 | 约30次 | 9% |
| 其他 | 约35次 | 10% |

---

## 四、问题诊断

### 4.1 根因分析

**数据格式不匹配**

| 期望格式 | 实际格式 |
|---------|---------|
| `"某某公司5": {"原脱敏标识": "某某公司5", "公司名称": "..."}` | `"公司标识_1": "国信金融租赁股份有限公司"` |

**证据规划中涉及方**：
```json
"涉及方": ["某某公司5", "某某公司1"]
```

**公司Profile库**：
```json
"公司Profile库": {
  "公司标识_1": "国信金融租赁股份有限公司",
  "公司标识_2": "江西洪城商业管理有限公司"
}
```

### 4.2 问题定位

`_extract_involved_companies()` 方法无法匹配，因为：
1. 证据使用"某某公司5"作为标记
2. Profile库使用"公司标识_1"作为键名
3. 即使键名匹配，值也是字符串而非对象，无"公司名称"字段

---

## 五、详细测试数据

### 5.1 证据规划样本

```json
{
  "证据序号": 1,
  "证据名称": "《转让合同》",
  "关键数据提示": {
    "涉及方": ["某某公司5", "某某公司1"]
  }
}
```

### 5.2 公司Profile库实际数据

```json
{
  "公司标识_1": "国信金融租赁股份有限公司",
  "公司标识_2": "江西洪城商业管理有限公司",
  "公司标识_3": "南昌洪城置业有限公司"
}
```

### 5.3 生成证据中的占位符示例

```
某某公司5
某某公司1
X年X月X日
人民币X元
【X】
```

---

## 六、结论与建议

### 6.1 测试结论

| 验收项 | 目标 | 实际 | 结果 |
|--------|------|------|------|
| 无占位符残留率 | ≥95% | 24% | ❌ 失败 |
| Prompt包含具体公司名 | 100% | 0% | ❌ 失败 |
| Prompt包含具体金额 | 100% | 部分 | ⚠️ 部分 |

### 6.2 问题严重程度

| 问题 | 严重程度 | 说明 |
|------|---------|------|
| 数据格式不匹配 | **严重** | 导致无法提取公司信息 |
| 占位符大量残留 | **严重** | 24%通过率远低于95%目标 |

### 6.3 建议修复方案

**方案A：修复stage0数据生成**
修改stage0_service.py，使公司Profile库格式与证据规划匹配：
```json
"公司Profile库": {
  "某某公司5": {
    "原脱敏标识": "某某公司5",
    "公司名称": "国信金融租赁股份有限公司"
  }
}
```

**方案B：修改PromptBuilder适配实际格式**
修改`_extract_involved_companies()`，适配当前数据格式

### 6.4 建议下一步

1. 修复数据格式不匹配问题
2. 重新执行黑盒测试
3. 验证95%通过率目标

---

## 七、附件

### 7.1 相关文档

| 文档 | 说明 |
|------|------|
| TD-2026-02-01-002 | 详细设计文档 |
| TC-2026-02-01-002 | 测试用例文档 |
| test_report.md | 主测试报告 |

---

**报告版本**: v1.0
**创建日期**: 2026-02-01
**最后更新**: 2026-02-01
