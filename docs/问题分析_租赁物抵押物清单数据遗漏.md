# 问题分析文档：租赁物清单与抵押物清单数据遗漏问题

**文档编号**: PA-2026-01-27-001  
**版本**: v1.0  
**日期**: 2026-01-27  
**状态**: 待产品评估

---

## 一、问题描述

### 1.1 现象

在PDF生成过程中，**租赁物清单**和**抵押物清单**两个关键数据部分无法正常渲染到输出PDF中。

**表现形式**：
- PDF中显示"附件一：租赁物清单（略）"
- PDF中显示"附件一：抵押物清单（略）"
- PDF中缺少租赁物/抵押物的详细表格数据

### 1.2 影响范围

| 影响项 | 说明 |
|--------|------|
| 证据完整性 | 租赁物是融资租赁合同的核心要素，缺失影响证据完整性 |
| 诉讼主张 | 抵押物优先受偿权需要明确的抵押物清单支撑 |
| PDF可读性 | "（略）"标记表明数据未填充，影响文档专业性 |

---

## 二、数据流分析

### 2.1 正常数据流

```
原始判决书
    ↓
Stage 0 数据提取 (0.1_结构化提取 → 0.2_脱敏策划 → 0.3_交易重构 → 0.4_关键数字)
    ↓
outputs/stage0/0.4_key_numbers.json
    ↓
Stage 1 证据生成 (1.1_起诉状 → 1.2_证据包 → 1.3_程序文件)
    ↓
outputs/stage1/evidence/
    ↓
Stage 2 PDF生成 (pdf_generator_simple.py)
    ↓
outputs/完整测试卷宗_简化版.pdf
```

### 2.2 当前数据流状态

| 阶段 | 文件 | 租赁物清单 | 抵押物清单 | 状态 |
|------|------|-----------|-----------|------|
| 原始材料 | 判决书.md | ✅ 有（引用） | ✅ 有（引用） | 存在但不详细 |
| Stage 0 | 0.4_key_numbers.json | ❌ 无 | ❌ 无 | **数据丢失** |
| Stage 1 | 证据文件 | ❌ 无 | ❌ 无 | 未生成 |
| Stage 2 | PDF | ❌ （略） | ❌ （略） | 未渲染 |

### 2.3 数据缺失节点定位

**缺失节点**: `Stage 0` → `0.4_key_numbers.json`

**验证命令**:
```bash
python3 -c "
import json
with open('outputs/stage0/0.4_key_numbers.json') as f:
    data = json.load(f)
print('0.4_key_numbers.json 顶层键:', list(data.keys()))
print('租赁物清单键:', '✅ 存在' if '租赁物清单' in data else '❌ 不存在')
print('抵押物清单键:', '✅ 存在' if '抵押物清单' in data else '❌ 不存在')
"
```

**输出**:
```
0.4_key_numbers.json 顶层键: ['合同基础金额', '租金安排', '租金支付计划', ...]
租赁物清单键: ❌ 不存在
抵押物清单键: ❌ 不存在
```

---

## 三、根本原因分析

### 3.1 直接原因

**`prompts/stage0/0.4_关键数字提取.md` 中未定义租赁物清单和抵押物清单的数据结构**

该prompt定义了9个数据部分：
1. 合同基础金额 ✅
2. 租金安排 ✅
3. 租金支付计划 ✅
4. 放款明细 ✅
5. 保险理赔明细 ✅
6. 违约相关金额 ✅
7. 诉讼费用 ✅
8. 判决金额 ✅
9. 关键时间点 ✅
10. **租赁物清单** ❌ 未定义
11. **抵押物清单** ❌ 未定义

### 3.2 判决书数据现状分析

从判决书（`outputs/stage3/判决书(脱敏替换).txt`）中提取的信息：

**租赁物相关信息**（判决书第22-24行）：
```
"附件1设备清单载明：某某商场设备及附属设施62套"
"纳入评估范围的实物资产为机器设备，共计62项"
"评估值为：169,979,559.06元"
"（详见评估明细表）"
```

**抵押物相关信息**（判决书第25行）：
```
"坐落于江西省南昌市高新区的国有土地使用权及土地附属在建建筑物所有权"
"不动产权证号：赣（2016）南昌市不动产权第XXXXXXX号"
"担保的主债权金额为：150,000,000元整"
```

**问题**：
- 判决书中只有**引用**（"详见附件"），没有详细数据
- 详细数据可能在**证据文件**中（如《资产评估报告》、抵押登记证书）

### 3.3 数据来源分析

| 数据来源 | 可获取性 | 说明 |
|----------|---------|------|
| 判决书正文 | ⚠️ 部分 | 只有引用，没有详细清单 |
| 证据文件（E001-E021） | ✅ 可能有 | 《资产评估报告》、抵押登记证书中可能有 |
| 原始输入材料 | ✅ 可能有 | 如果有完整的原始材料 |
| 手动补充 | ⚠️ 可行 | 作为测试数据补充 |

---

## 四、影响评估

### 4.1 功能影响

| 影响项 | 严重程度 | 说明 |
|--------|---------|------|
| 证据完整性 | 🔴 高 | 租赁物是融资租赁合同的核心证据 |
| 诉讼主张 | 🔴 高 | 抵押物优先受偿权需要明确清单 |
| PDF专业性 | 🟡 中 | "（略）"影响文档可用性 |

### 4.2 数据影响

| 数据项 | 预期来源 | 当前状态 |
|--------|---------|---------|
| 租赁物清单（5项） | 证据文件或原始材料 | ❌ 未提取 |
| 抵押物清单（1项） | 证据文件或原始材料 | ❌ 未提取 |
| 租金支付计划（12期） | 判决书或合同 | ⚠️ 仅3期 |

---

## 五、解决方案选项

### 方案A：修改Prompt 0.4（推荐）

**思路**：在`0.4_关键数字提取.md`中添加租赁物清单和抵押物清单的提取要求。

**优点**：
- 从根本上解决问题
- 数据提取自动化
- 符合系统设计理念

**缺点**：
- 需要修改prompt
- 依赖LLM能够从判决书中提取或识别需要从证据文件中获取

**实施步骤**：
1. 修改`prompts/stage0/0.4_关键数字提取.md`
2. 添加租赁物清单和抵押物清单的数据结构定义
3. 更新质量控制检查点
4. 重新运行Stage 0

**数据结构示例**:
```json
{
  "租赁物清单": [
    {
      "序号": "integer",
      "名称": "string",
      "规格型号": "string",
      "数量": "string",
      "存放地点": "string",
      "评估价值": {
        "数值": "number",
        "单位": "string"
      }
    }
  ],
  "抵押物清单": [
    {
      "序号": "integer",
      "名称": "string",
      "不动产权证号": "string",
      "地址": "string",
      "建筑面积": "string",
      "评估价值": {
        "数值": "number",
        "单位": "string"
      },
      "所有人": "string"
    }
  ]
}
```

---

### 方案B：从证据文件提取

**思路**：在证据生成阶段（Stage 1）或PDF生成阶段（Stage 2），从证据文件中提取租赁物/抵押物数据。

**优点**：
- 不依赖判决书中的数据
- 利用已有的证据文件

**缺点**：
- 需要修改证据生成或PDF生成的逻辑
- 可能需要额外的文本解析

**实施步骤**：
1. 在`evidence_file_generator.py`中添加租赁物/抵押物提取逻辑
2. 或在`pdf_generator_simple.py`中添加从证据文件提取数据的逻辑

---

### 方案C：手动补充测试数据

**思路**：在`0.4_key_numbers.json`中手动添加租赁物清单和抵押物清单数据。

**优点**：
- 快速解决当前测试问题
- 不需要修改代码

**缺点**：
- 不是自动化解决方案
- 每次换数据都需要手动更新

**实施步骤**：
1. 在`outputs/stage0/0.4_key_numbers.json`中添加数据
2. 重新生成PDF

**数据示例**:
```json
{
  "租赁物清单": [
    {"序号": 1, "名称": "多联机中央空调系统", "规格型号": "VRV VIII代", "数量": "10套", "存放地点": "南昌市红谷滩区", "评估价值": 50000000},
    {"序号": 2, "名称": "电梯设备", "规格型号": "GECS-II", "数量": "4台", "存放地点": "南昌市红谷滩区", "评估价值": 30000000}
  ],
  "抵押物清单": [
    {"序号": 1, "名称": "南昌市XX广场商业房产", "不动产权证号": "赣（2021）南昌市不动产权第XXXXXX号", "地址": "江西省南昌市红谷滩区XX路XX号", "建筑面积": "5200㎡", "评估价值": 104000000, "所有人": "某某公司1"}
  ]
}
```

---

## 六、建议

### 6.1 短期建议（快速验证）

**方案C：手动补充测试数据**

适合当前测试需求，快速验证PDF生成功能。

### 6.2 中期建议（产品决策）

**方案A或B**

需要产品设计评估：
1. 租赁物/抵押物数据应该从哪个阶段提取？
2. 数据结构如何设计？
3. 如何处理数据来源多样性问题（判决书、证据文件、原始材料）？

### 6.3 长期建议（架构优化）

1. **建立标准化的案件数据结构**：明确各类金融案件（融资租赁、银行借贷、保理等）的必填数据字段
2. **数据溯源机制**：记录每个数据字段的来源（判决书、证据文件、人工补充）
3. **数据完整性校验**：在Stage 0完成后，检查必填数据字段是否完整

---

## 七、附录

### 7.1 相关文件

| 文件 | 说明 |
|------|------|
| `prompts/stage0/0.4_关键数字提取.md` | Stage 0数据提取prompt |
| `outputs/stage0/0.4_key_numbers.json` | Stage 0输出数据 |
| `outputs/stage3/判决书(脱敏替换).txt` | 脱敏后的判决书 |
| `docs/BUG_TRACKER.md` | Bug追踪清单 |
| `docs/TEST_PLAN.md` | 测试方案 |

### 7.2 验证命令

```bash
# 检查0.4_key_numbers.json中的数据
python3 -c "
import json
with open('outputs/stage0/0.4_key_numbers.json') as f:
    data = json.load(f)
print('0.4_key_numbers.json 顶层键:', list(data.keys()))
print('租赁物清单键:', '✅ 存在' if '租赁物清单' in data else '❌ 不存在')
print('抵押物清单键:', '✅ 存在' if '抵押物清单' in data else '❌ 不存在')
"

# 检查PDF中的数据
python3 -c "
from pdfminer.high_level import extract_text
t = extract_text('outputs/完整测试卷宗_简化版.pdf')
print('租赁物清单:', t.count('租赁物清单'), '处')
print('抵押物清单:', t.count('抵押物清单'), '处')
print('（略）:', t.count('（略）'), '处')
"
```

### 7.3 相关Bug

| Bug ID | 描述 | 状态 |
|--------|------|------|
| BUG-001 | 公司脱敏名称未替换 | ✅ 已修复 |
| BUG-010 | LLM创造脱敏模式 | ✅ 已修复 |
| BUG-011 | 证据文件无换行符 | ✅ 已修复 |
| BUG-012 | "某地址"异常模式 | ✅ 已修复 |
| DATA-001 | 租赁物清单数据缺失 | 🔴 待解决 |
| DATA-002 | 抵押物清单数据缺失 | 🔴 待解决 |
| DATA-003 | 租金支付计划不完整 | 🟡 待解决 |

---

**文档结束**

**创建人**: OpenCode AI  
**创建日期**: 2026-01-27  
**下一步**: 待产品设计评估
