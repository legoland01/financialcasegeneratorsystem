# 金融案件证据集生成系统 v3.0 - 产品需求文档

**文档编号**: PRD-2026-02-01-v3.0
**版本**: v3.0.0
**状态**: 初稿
**日期**: 2026-02-01

---

## 一、文档说明

### 1.1 文档目的

定义金融案件证据集生成系统的产品需求，明确系统边界、功能范围和质量标准。

### 1.2 适用范围

| 范围 | 说明 |
|------|------|
| 系统边界 | 判决书 → 证据集PDF |
| 不包含 | 判决书内容生成、法院对接 |
| 用户角色 | 法官、律师、当事人 |

### 1.3 术语定义

| 术语 | 定义 |
|------|------|
| 证据集 | 包含起诉状+证据材料的PDF文件 |
| 脱敏标记 | 用于替换真实信息的占位符（如"某某公司"） |
| 反脱敏 | 将脱敏标记还原为真实信息 |

---

## 二、产品概述

### 2.1 产品愿景

让法律从业者**一键生成**符合法院标准的证据集文档。

### 2.2 核心价值

| 价值 | 说明 |
|------|------|
| 效率提升 | 原本3天 → 现在3分钟 |
| 质量保证 | 自动校验，减少人为错误 |
| 格式规范 | 自动符合法院标准 |

### 2.3 核心设计理念

```
输入: 判决书（PDF）
输出: 证据集PDF（起诉状 + 证据材料）

核心原则:
1. 配置驱动 - 所有证据类型、模板、字段均可配置
2. 数据驱动 - 所有内容基于判决书数据自动生成
3. 质量驱动 - 每一步都有质量校验，不合格不推进
```

---

## 三、功能需求

### 3.1 系统边界（System Boundary）

```
┌─────────────────────────────────────────────────────────────┐
│                    证据集生成系统                           │
│                                                             │
│  输入: 判决书 PDF                                           │
│         ↓                                                   │
│  处理: Stage 0 → Stage 1 → Stage 1.5 → Stage 2            │
│         ↓                                                   │
│  输出: 证据集 PDF                                           │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

**系统不包含**：
- 判决书内容生成
- 法院系统对接
- 电子送达

### 3.2 Stage 0: 数据理解

**目标**: 从判决书提取结构化信息

| 功能 | 输入 | 输出 |
|------|------|------|
| 结构化提取 | 判决书全文 | 诉讼请求、案件事实 |
| 脱敏策划 | 公司/人名 | 脱敏标记映射表 |
| 交易重构 | 合同/证据 | 交易结构图 |
| 关键数字 | 金额/日期 | 数字清单 |
| 证据规划 | 交易结构 | 证据列表 |

**输出文件**:
```
stage0/
├── 0.1_structured_extraction.json    # 结构化提取结果
├── 0.2_anonymization_plan.json       # 脱敏策划
├── 0.3_transaction_reconstruction.json # 交易重构
├── 0.4_key_numbers.json              # 关键数字
└── 0.5_evidence_planning.json        # 证据规划
```

### 3.3 Stage 1: 证据生成

**目标**: 生成所有证据材料

| 功能 | 输入 | 输出 |
|------|------|------|
| 起诉状生成 | 诉讼请求 | 起诉状.txt |
| 合同生成 | 证据规划 | 合同.txt |
| 凭证生成 | 证据规划 | 凭证.txt |
| 附件生成 | 关键数字 | 租赁物清单、租金计划等 |

**输出文件**:
```
stage1/
├── 民事起诉状.txt
├── evidence_index.json              # 证据索引
└── evidence/
    ├── 证据组1/
    ├── 证据组2/
    └── ...
```

### 3.4 Stage 1.5: 后处理（v3.0新增）

**目标**: 清理占位符，填充数据

| 功能 | 输入 | 输出 |
|------|------|------|
| 占位符检测 | 证据文本 | 问题列表 |
| 数据填充 | 占位符+key_numbers | 填充后证据 |
| 完整性校验 | 所有证据 | 校验报告 |

**校验规则**:
```json
{
  "rules": [
    {"pattern": "某某公司[0-9]*", "source": "company_profile"},
    {"pattern": "X年X月X日", "source": "key_numbers"},
    {"pattern": "人民币[0-9]+元", "source": "key_numbers"}
  ]
}
```

### 3.5 Stage 2: PDF渲染

**目标**: 生成符合法院标准的PDF

| 功能 | 输入 | 输出 |
|------|------|------|
| 合同渲染 | 合同文本 | PDF元素 |
| 表格渲染 | 表格数据 | PDF表格 |
| 分页控制 | 所有元素 | 分页结果 |
| PDF生成 | 所有元素 | 证据集.pdf |

**格式规范**:
- 合同：标准合同格式，含签署栏
- 表格：斑马纹，表头灰底
- 分页：每份证据独立一页

### 3.6 Stage 2.5: 质量验证（v3.0新增）

**目标**: 确保输出质量

| 验证项 | 检查内容 | 处理 |
|--------|---------|------|
| 占位符检查 | 是否还有脱敏标记 | 不合格则阻止输出 |
| 完整性检查 | 必填字段是否完整 | 不合格则阻止输出 |
| 一致性检查 | 金额是否一致 | 警告但不阻止 |

**质量等级**:
| 等级 | 定义 | 处理 |
|------|------|------|
| P0 | 可用 | 可输出 |
| P1 | 基本可用 | 警告但不阻止 |
| P2 | 不可用 | 阻止输出 |

---

## 四、数据规范

### 4.1 数据流

```
判决书 PDF
    ↓
Stage 0 输出 (5个JSON文件)
    ↓
Stage 1 输入
    ↓
Stage 1 输出 (证据文件 + evidence_index.json)
    ↓
Stage 1.5 输入/输出
    ↓
Stage 2 输入
    ↓
证据集 PDF
```

### 4.2 关键数据结构

#### 4.2.1 证据索引 (evidence_index.json)

```json
{
  "证据总数": 24,
  "证据组数": 9,
  "证据列表": [
    {
      "证据ID": "E001",
      "证据名称": "转让合同",
      "文件路径": "证据组1/E001_转让合同.txt",
      "文件类型": "合同",
      "证明目的": "证明融资租赁关系"
    }
  ]
}
```

#### 4.2.2 脱敏策划 (0.2_anonymization_plan.json)

```json
{
  "公司Profile库": {
    "某某公司5": {
      "原脱敏标识": "某某公司5",
      "公司名称": "东方金融租赁有限公司",
      "统一社会信用代码": "91310000MA1FL3L123"
    }
  },
  "机构Profile库": {
    "某某公证处": {
      "原脱敏标识": "某某公证处",
      "机构名称": "南昌市公证处"
    }
  }
}
```

#### 4.2.3 关键数字 (0.4_key_numbers.json)

```json
{
  "合同基础金额": {
    "原合同金额": {
      "数值": 150000000,
      "单位": "元",
      "大写": "壹亿伍仟万元整"
    }
  },
  "租赁物清单": [
    {"序号": 1, "名称": "设备A", "评估价值": 45000000}
  ]
}
```

### 4.3 配置规范

#### 4.3.1 证据类型配置

```json
{
  "case_type": "融资租赁纠纷",
  "evidence_types": [
    {
      "type": "合同",
      "template": "contract_template.md",
      "attachments": ["租赁物清单", "租金支付计划"]
    },
    {
      "type": "凭证",
      "template": "voucher_template.md"
    }
  ]
}
```

---

## 五、质量标准

### 5.1 占位符标准

**禁止使用的占位符**:
- `某某公司`、`某公司`
- `X年X月X日`
- `人民币X元`
- `若干`、`某些`

**检测方法**: 正则表达式匹配

### 5.2 格式标准

| 类型 | 标准 |
|------|------|
| 合同 | 含合同编号、当事人、签署栏 |
| 表格 | 表头灰底、斑马纹、边框0.5pt |
| 分页 | 每份证据独立一页 |

### 5.3 数据一致性标准

| 检查项 | 标准 |
|--------|------|
| 合同金额 = 租赁物清单合计 | 必须相等 |
| 租金期数 = 租金计划行数 | 必须相等 |
| 证据ID唯一性 | 不重复 |

---

## 六、非功能需求

### 6.1 性能需求

| 指标 | 要求 |
|------|------|
| Stage 0 | < 5分钟（5个子任务） |
| Stage 1 | < 10分钟（33个证据） |
| Stage 2 | < 1分钟 |

### 6.2 质量需求

| 指标 | 要求 |
|------|------|
| 占位符残留率 | < 5% |
| 数据一致性 | 100% |
| PDF格式规范性 | 100% |

### 6.3 可扩展性需求

| 需求 | 说明 |
|------|------|
| 新证据类型 | 仅需添加配置，不改代码 |
| 新案件类型 | 仅需添加配置文件 |
| 新模板 | 仅需添加模板文件 |

---

## 七、验收标准

### 7.1 功能验收

| 验收项 | 标准 |
|--------|------|
| 判决书输入 | 支持PDF格式 |
| Stage 0输出 | 5个JSON文件完整 |
| Stage 1输出 | 所有规划证据生成 |
| Stage 2输出 | 符合格式规范的PDF |

### 7.2 质量验收

| 验收项 | 标准 |
|--------|------|
| 无占位符 | 95%以上证据无脱敏标记 |
| 金额一致 | 合同金额=租赁物合计 |
| 格式规范 | 100%符合法院标准 |

### 7.3 性能验收

| 验收项 | 标准 |
|--------|------|
| 端到端耗时 | < 15分钟 |
| 单证据生成 | < 30秒 |

---

## 八、附录

### 8.1 相关文档

| 文档 | 说明 |
|------|------|
| [概要设计_v3.0](详细设计_TD-2026-02-01-v3.0.md) | 技术实现方案 |
| [测试方案](TEST_PLAN.md) | 测试计划 |
| [问题记录](问题记录.md) | Bug修复日志 |

### 8.2 修订历史

| 版本 | 日期 | 变更 |
|------|------|------|
| v3.0.0 | 2026-02-01 | 全新设计，模块化重构 |

---

**文档版本**: v3.0.0
**创建日期**: 2026-02-01
**最后更新**: 2026-02-01
