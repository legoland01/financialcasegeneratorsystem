# 金融案件证据集生成系统 v2.0 - 黑盒测试报告

**测试日期**: 2026-01-29  
**测试版本**: v2.0.1  
**测试命令**: `python3 run_complete.py`  
**测试环境**: macOS + SiliconFlow API (DeepSeek-V3.2)

---

## 一、测试概述

### 1.1 测试目标
作为最终用户，使用单一命令生成完整卷宗，检查输出是否满足要求。

### 1.2 测试命令
```bash
python3 run_complete.py
```

---

## 二、测试结果

### 2.1 执行状态：❌ 中断

### 2.2 问题描述

**入口脚本设计缺陷 - 无法生成完整卷宗**

| 命令 | Stage 0 | Stage 1 | PDF | 结果 |
|------|---------|---------|-----|------|
| `python3 run_complete.py` | ✅ | ❌ | ✅* | PDF失败（缺证据文件） |
| `python3 run_complete.py --stage0` | ✅ | ❌ | ❌ | 只生成Stage 0 |
| `python3 run_complete.py --stage1` | ✅ | ✅ | ❌ | 缺少PDF生成 |

*PDF生成需要 `outputs_complete/原告起诉包/evidence_index.json`，该文件由Stage 1生成。

---

## 三、问题分析

### 3.1 代码问题位置

`run_complete.py` 第452-455行：
```python
if not args.stage0 and not args.stage1:
    logger.info("\n生成PDF...")
    run_pdf_generation()
```

### 3.2 逻辑矛盾

```
默认流程: Stage 0 → PDF
          ↓
    PDF需要: evidence_index.json
          ↓
    evidence_index.json 由 Stage 1 生成
          ↓
    但默认流程不运行 Stage 1
          ↓
    结果: PDF生成失败
```

### 3.3 用户体验

| 用户期望 | 实际行为 |
|----------|----------|
| 一个命令生成全部 | 需要手动分步执行 |
| 无需了解内部逻辑 | 需要知道 `--stage0`、`--stage1` 区别 |
| 自动化程度高 | 需要多次调用不同命令 |

---

## 四、测试结论

### 4.1 严重问题

| ID | 问题 | 严重程度 | 影响 |
|----|------|----------|------|
| BUG-ENTRY-001 | 入口脚本无法生成完整卷宗 | 🔴 高 | 用户无法一键生成完整卷宗 |

### 4.2 功能验证状态

| 功能 | 状态 | 说明 |
|------|------|------|
| Stage 0 判决书解析 | ✅ 正常 | 5个子任务全部成功 |
| Stage 1 证据生成 | ⚠️ 部分 | 需要手动指定参数 |
| PDF 生成 | ❌ 失败 | 因缺少证据文件而失败 |
| 完整流程 | ❌ 不可用 | 无单一命令支持 |

### 4.3 总体评估

| 评估项 | 结果 |
|--------|------|
| 用户体验 | ❌ 不符合"一个命令"要求 |
| 自动化程度 | ❌ 需要分步执行 |
| 功能完整性 | ⚠️ 组件可用，流程不通 |

---

## 五、修复建议

### 5.1 方案A: 添加 `--all` 参数

```python
parser.add_argument('--all', action='store_true', help='完整流程 (Stage0 → Stage1 → PDF)')

# 在main函数中添加
if args.all:
    # 运行完整流程
```

### 5.2 方案B: 修改默认行为

```python
# 默认运行完整流程
if not args.stage0:
    # 如果没有指定--stage0，运行完整流程
```

### 5.3 推荐

推荐 **方案A**，添加 `--all` 参数，保持向后兼容。

---

## 六、后续测试

待入口脚本修复后，需要重新测试：

1. **完整流程测试**: `python3 run_complete.py --all`
2. **Stage 0产物验证**: 5个文件完整性
3. **Stage 1产物验证**: 民事起诉状 + 证据文件
4. **PDF验证**: 完整卷宗PDF生成
5. **数据质量验证**: 金额一致性、反脱敏

---

**报告创建**: 2026-01-29  
**版本**: v1.0  
**状态**: 中断（待入口脚本修复后重新测试）  
**测试人员**: OpenCode AI
