# 测试报告

---

## 测试记录 2026-02-01 10:05 (Agent1产品经理) - 真实验证

**测试类型**: 黑盒测试 (run_complete.py完整流程，使用真实OPENAI_API_KEY)
**测试结果**: ❌ 未通过 - LLM持续生成占位符

### 测试结果

| 项目 | 值 |
|------|-----|
| 模式 | 真实LLM调用 |
| 重试机制 | ✅ 工作正常 |
| 占位符检测 | ✅ 工作正常 |
| LLM遵从Prompt | ❌ 无效 |

### 问题分析

**根本原因**: Prompt没有直接列出具体当事人信息，而是传递JSON格式的Profile库，LLM难以正确使用。

### 修复方案（2026-02-01）

**修改文件**: `src/services/evidence_file_generator.py`

**修复内容**: 
1. 新增`_build_party_info_direct`方法，直接列出所有公司名称和完整信息
2. 修改`_build_prompt`方法，在生成每个证据文件时直接列出具体当事人信息
3. 明确指定："甲方：上海锦江贸易有限公司" 而非让LLM从JSON中查找

**修复后的Prompt示例**:
```
【必须使用的具体信息】
【所有公司信息】（生成时必须使用这些具体名称）:
  • 上海锦江贸易有限公司
    统一社会信用代码：91310000MA1XXXXXXX
    法定代表人：张明
    地址：上海市浦东新区陆家嘴环路1000号

生成合同/文书时，必须使用上面列出的**具体公司名称**，
例如：
  • 甲方：上海锦江贸易有限公司（禁止使用'某某公司'）
```

### 待测试验证

修复后需要重新执行真实验证，确认LLM是否能够正确使用具体公司名称。

---

## 测试记录 2026-02-01 02:22 (Agent1产品经理)

**测试类型**: 黑盒测试 (run_complete.py完整流程)
**测试结果**: ❌ 未通过

### 测试统计

| 指标 | 值 |
|------|-----|
| 证据文件 | 76个 |
| PDF大小 | 600KB |
| PDF页数 | 107页 |
| 证据验证通过 | 3/76 (3.9%) |

### 问题

发现Mock模式自动开启（OPENAI_API_KEY未设置），导致占位符检查被绕过。

---

## 测试记录 2026-02-01 01:15 (Agent1产品经理)

**测试类型**: 黑盒测试 (run_complete.py完整流程)
**测试结果**: ❌ 未通过

### 测试统计

| 指标 | 值 |
|------|-----|
| 证据文件 | 61个 |
| PDF大小 | 546KB |
| PDF页数 | 87页 |
| 证据验证通过 | 3/61 (4.9%) |

### 问题分析

**发现**: 占位符清理机制**未正确集成**

| 组件 | 状态 |
|------|------|
| placeholder_checker.py | ✅ 已创建 |
| retry_handler.py | ✅ 已创建 |
| stage1_service.py集成 | ❌ 未生效 |

---

## 测试记录 2026-02-01 00:16 (Agent1产品经理)

**测试类型**: 黑盒测试 (run_complete.py完整流程)
**测试结果**: ⚠️ 部分通过

### 测试统计

| 指标 | 值 |
|------|-----|
| 证据文件 | 20个 (53个变体) |
| PDF大小 | 516KB |
| PDF页数 | 72页 |
| 证据验证通过 | 3/53 (5.7%) |

---

## 测试记录 2026-01-31 23:41 (Agent1产品经理)

**测试类型**: 黑盒测试 (run_complete.py完整流程)
**测试结果**: ⚠️ 部分通过

agent2修复了运行时崩溃问题。新的问题是占位符未清理、脱敏标记残留。

---

## 测试记录 2026-01-31 22:11 (Agent1产品经理)

**测试类型**: 黑盒测试 (run_complete.py完整流程)
**测试结果**: ❌ 失败

### 问题详情

| 问题ID | 严重程度 | 位置 | 描述 |
|--------|---------|------|------|
| BUG-001 | **严重** | stage1_service.py:120 | KeyError: '证据归属规划表' |
| BUG-002 | **中等** | stage0/0.5输出 | JSON解析异常 |

---

## 测试记录 2026-01-31 12:23

**时间**: 2026-01-31 12:23:42
**检查**: 3/3 通过
