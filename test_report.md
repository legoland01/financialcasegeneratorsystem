# 测试报告

---

## 测试记录 2026-02-01 10:05 (Agent1产品经理) - 真实验证

**测试类型**: 黑盒测试 (run_complete.py完整流程，使用真实OPENAI_API_KEY)
**测试结果**: ❌ 未通过 - LLM持续生成占位符

### 测试结果

| 项目 | 值 |
|------|-----|
| 模式 | 真实LLM调用 |
| 重试机制 | ✅ 工作正常 |
| 占位符检测 | ✅ 工作正常 |
| LLM遵从Prompt | ❌ 无效 |

### 观察到的现象

1. ✅ **重试机制正常工作**
   ```
   尝试 1/4 失败，占位符: ['某某公司5', '某某', '某某公司1']...
   重试 4 次后仍失败
   ```

2. ❌ **LLM持续生成占位符**
   - 即使Prompt明确禁止"某某"、"某公司"，LLM仍生成这些占位符
   - 4次重试均失败

### 测试用例结果

| 用例ID | 预期 | 实际 | 状态 |
|--------|------|------|------|
| QB-T002 | 自动重试 | 重试触发 | ✅ |
| QB-T003 | 4次后降级 | 4次后失败 | ✅ |
| QB-T008 | ≥95%通过 | 0% | ❌ |

### 问题分析

| 组件 | 状态 | 说明 |
|------|------|------|
| 重试机制 | ✅ 正常 | 检测到占位符后自动重试 |
| 占位符检测 | ✅ 正常 | 正确识别占位符 |
| LLM遵从Prompt | ❌ 无效 | LLM持续生成占位符 |

### 结论

**根本问题**: Prompt约束对LLM无效，需要进一步优化

**待agent2处理**:
1. 增强Prompt（添加示例、更强约束）
2. 调整Prompt上下文（确保公司名称已填入）
3. 或考虑后处理填充方案

---

## 测试记录 2026-02-01 02:22 (Agent1产品经理)

**测试类型**: 黑盒测试 (run_complete.py完整流程)
**测试结果**: ❌ 未通过

### 测试统计

| 指标 | 值 |
|------|-----|
| 证据文件 | 76个 |
| PDF大小 | 600KB |
| PDF页数 | 107页 |
| 证据验证通过 | 3/76 (3.9%) |

### 问题

发现Mock模式自动开启（OPENAI_API_KEY未设置），导致占位符检查被绕过。

---

## 测试记录 2026-02-01 01:15 (Agent1产品经理)

**测试类型**: 黑盒测试 (run_complete.py完整流程)
**测试结果**: ❌ 未通过

### 测试统计

| 指标 | 值 |
|------|-----|
| 证据文件 | 61个 |
| PDF大小 | 546KB |
| PDF页数 | 87页 |
| 证据验证通过 | 3/61 (4.9%) |

### 问题分析

**发现**: 占位符清理机制**未正确集成**

| 组件 | 状态 |
|------|------|
| placeholder_checker.py | ✅ 已创建 |
| retry_handler.py | ✅ 已创建 |
| stage1_service.py集成 | ❌ 未生效 |

---

## 测试记录 2026-02-01 00:16 (Agent1产品经理)

**测试类型**: 黑盒测试 (run_complete.py完整流程)
**测试结果**: ⚠️ 部分通过

### 测试统计

| 指标 | 值 |
|------|-----|
| 证据文件 | 20个 (53个变体) |
| PDF大小 | 516KB |
| PDF页数 | 72页 |
| 证据验证通过 | 3/53 (5.7%) |

---

## 测试记录 2026-01-31 23:41 (Agent1产品经理)

**测试类型**: 黑盒测试 (run_complete.py完整流程)
**测试结果**: ⚠️ 部分通过

agent2修复了运行时崩溃问题。新的问题是占位符未清理、脱敏标记残留。

---

## 测试记录 2026-01-31 22:11 (Agent1产品经理)

**测试类型**: 黑盒测试 (run_complete.py完整流程)
**测试结果**: ❌ 失败

### 问题详情

| 问题ID | 严重程度 | 位置 | 描述 |
|--------|---------|------|------|
| BUG-001 | **严重** | stage1_service.py:120 | KeyError: '证据归属规划表' |
| BUG-002 | **中等** | stage0/0.5输出 | JSON解析异常 |

---

## 测试记录 2026-01-31 12:23

**时间**: 2026-01-31 12:23:42
**检查**: 3/3 通过
